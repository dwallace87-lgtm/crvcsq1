<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Formative Performance Task: Analyzing the Sale of Manhattan</title>
<script src="https://cdn.tailwindcss.com?plugins=typography"></script>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&family=Noto+Naskh+Arabic:wght@400;600;700&display=swap" rel="stylesheet"/>
<style>
  :root { --bubble-w: 320px; }
  body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
  html[dir="rtl"] body { font-family: 'Noto Naskh Arabic', serif; }
  textarea { transition: all .2s; resize: vertical; min-height: 112px; }
  textarea:focus { box-shadow: 0 0 0 4px rgba(99,102,241,.2); border-color:#6366f1; }
  tbody tr { transition: background-color .15s; } tbody tr:hover { background:#f4f5ff; }
  .tooltip-trigger{ color:#2563eb; font-weight:600; border-bottom:2px dotted #bfdbfe; cursor:pointer; transition:all .2s; }
  .tooltip-trigger:hover{ color:#1d4ed8; background:#eff6ff; }
  .hidden{ display:none; }
  @keyframes highlight-glint {
    0% { box-shadow: 0 0 0 rgba(255,255,255,0); }
    50% { box-shadow: 0 0 10px rgba(255,255,255,0.75); }
    100% { box-shadow: 0 0 0 rgba(255,255,255,0); }
  }
  .highlight-yellow {
    background-color:#fcf9b2;
    transition:background-color .3s ease;
    padding:0 .2rem;
    border-radius:.25rem;
    box-shadow:inset 0 0 0 1px rgba(202,138,4,.35);
    animation:highlight-glint 3s infinite ease-in-out;
  }
  .highlight-green {
    background-color:#c7f2cb;
    transition:background-color .3s ease;
    padding:0 .2rem;
    border-radius:.25rem;
    box-shadow:inset 0 0 0 1px rgba(22,163,74,.35);
    animation:highlight-glint 3s infinite ease-in-out;
  }
  .highlight-surface.highlights-off .highlight-yellow,
  .highlight-surface.highlights-off .highlight-green {
    background-color:transparent !important;
    box-shadow:none;
    animation:none;
  }
  .highlight-toolbar{ display:flex; flex-wrap:wrap; align-items:center; gap:.5rem .75rem; }
  .highlight-toolbar .toolbar-label{ font-size:.65rem; letter-spacing:.1em; font-weight:700; text-transform:uppercase; color:#6b7280; }
  .highlight-btn{ display:inline-flex; align-items:center; gap:.35rem; padding:.45rem .9rem; border-radius:9999px; font-size:.8rem; font-weight:600; box-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); border:1px solid transparent; background:#fff; color:#1f2937; transition:transform .2s ease, filter .2s ease, box-shadow .2s ease; cursor:pointer; }
  .highlight-btn svg{ width:1rem; height:1rem; }
  .highlight-btn:focus{ outline:2px solid transparent; outline-offset:2px; box-shadow:0 0 0 4px rgba(99,102,241,.18), 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
  .highlight-btn:active{ transform:scale(.96); filter:brightness(.95); }
  .highlight-btn-yellow{ background-color:#fcf9b2; border-color:#fde047; color:#78350f; }
  .highlight-btn-yellow:hover{ transform:scale(1.05); filter:brightness(.95); }
  .highlight-btn-green{ background-color:#c7f2cb; border-color:#86efac; color:#14532d; }
  .highlight-btn-green:hover{ transform:scale(1.05); filter:brightness(.95); }
  .highlight-btn-toggle{ background-image:linear-gradient(to right,#818cf8,#6366f1); color:#fff; border-color:transparent; }
  .highlight-btn-toggle:hover{ transform:scale(1.05); filter:brightness(1.05); }
  .highlight-btn-clear{ background-image:linear-gradient(to right,#f87171,#ef4444); color:#fff; border-color:transparent; }
  .highlight-btn-clear:hover{ transform:scale(1.05); filter:brightness(1.05); }
  html[dir="rtl"] .highlight-toolbar .toolbar-label{ text-transform:none; letter-spacing:normal; }
  html[dir="rtl"] .highlight-btn{ flex-direction:row-reverse; }
  #submit-work-btn[disabled]{ cursor:not-allowed; }
  /* Manhattan map hotspots */
  .hotspot{ position:absolute; border:2px solid rgba(59,130,246,.9); background:rgba(59,130,246,.12); border-radius:.5rem; cursor:pointer; outline:none; pointer-events:auto; box-sizing:border-box; }
  .hotspot::after{ content:""; position:absolute; inset:-6px; border:2px dashed rgba(59,130,246,.35); border-radius:.65rem; animation:pulse 1.8s ease-in-out infinite; }
  @keyframes pulse{ 0%{opacity:.7; transform:scale(1)} 50%{opacity:.2; transform:scale(1.03)} 100%{opacity:.7; transform:scale(1)} }
  /* Bubbles */
  #map-bubble{ position:fixed; display:none; z-index:50; width:var(--bubble-w); max-width:calc(100vw - 2rem); }
  #tooltip-bubble{ position:fixed; }
</style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-indigo-100 text-gray-800 p-4 md:p-8 min-h-screen">

  <!-- Top controls -->
  <div class="max-w-5xl mx-auto bg-white p-6 md:p-8 rounded-2xl shadow-xl mb-6">
    <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
      <div>
        <h1 id="i-title" class="text-3xl md:text-4xl font-extrabold text-gray-900">Formative Performance Task</h1>
        <h2 id="i-sub" class="text-xl md:text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 mt-1">Analyzing the Sale of Manhattan</h2>
      </div>
      <div class="flex flex-wrap items-center gap-3">
        <div class="flex items-center gap-2">
          <label id="i-language" for="lang" class="text-sm font-semibold text-gray-700">Language</label>
          <select id="lang" class="border rounded-lg px-3 py-2 text-sm bg-white">
            <option value="en">English</option>
            <option value="es">Español (LatAm)</option>
            <option value="fr">Français</option>
            <option value="ar">العربية</option>
          </select>
        </div>
        <div class="flex flex-col gap-1">
          <div class="flex flex-wrap gap-2 justify-end">
            <button id="save-progress-btn" type="button" class="inline-flex items-center gap-2 rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-md transition hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2">
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 16v1a2 2 0 01-2 2H9a2 2 0 01-2-2v-1m10 0h1a1 1 0 001-1V7.414a1 1 0 00-.293-.707l-4.414-4.414A1 1 0 0012.586 2H8a2 2 0 00-2 2v11a1 1 0 001 1h10zm-3-6a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
              <span>Save Progress</span>
            </button>
            <button id="submit-work-btn" type="button" class="inline-flex items-center gap-2 rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-md transition hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-60 disabled:pointer-events-none" disabled aria-disabled="true">
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 16.5V21h4.5M20 7l-8.5 8.5m0 0L9 21l5.5-2.5m-3-3L3 9l5-5 8.5 8.5" />
              </svg>
              <span>Submit Work</span>
            </button>
          </div>
          <p id="save-progress-status" class="text-xs text-right text-gray-500" aria-live="polite"></p>
        </div>
      </div>
    </div>
    <form id="student-info" class="mt-6 grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4" autocomplete="off" novalidate>
      <div class="flex flex-col">
        <label for="student-first-name" class="text-sm font-semibold text-gray-700">First Name</label>
        <input id="student-first-name" name="student-first-name" type="text" required data-entry-field="true" autocomplete="given-name"
               class="mt-1 rounded-lg border-2 border-gray-200 px-3 py-2 text-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200"/>
      </div>
      <div class="flex flex-col">
        <label for="student-last-name" class="text-sm font-semibold text-gray-700">Last Name</label>
        <input id="student-last-name" name="student-last-name" type="text" required data-entry-field="true" autocomplete="family-name"
               class="mt-1 rounded-lg border-2 border-gray-200 px-3 py-2 text-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200"/>
      </div>
      <div class="flex flex-col">
        <label for="class-period" class="text-sm font-semibold text-gray-700">Class Period</label>
        <select id="class-period" name="class-period" required class="mt-1 rounded-lg border-2 border-gray-200 px-3 py-2 text-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 bg-white">
          <option value="">Select a period</option>
          <option value="3">3</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
        </select>
      </div>
      <div class="flex flex-col justify-center rounded-lg border border-indigo-100 bg-indigo-50 px-3 py-2" aria-live="polite">
        <span class="text-sm font-semibold text-indigo-700">Eastern Time</span>
        <span id="eastern-timestamp" class="text-base font-bold text-indigo-900">--:--</span>
      </div>
    </form>
    <div class="bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded-lg mt-4">
      <h3 id="i-sq-title" class="text-lg font-bold text-indigo-900">Supporting Question 1:</h3>
      <p id="i-sq-body" class="text-lg text-indigo-800 mt-1">Did the Munsee Lenape band of Algonquin benefit from the sale of Manhattan Island?</p>
    </div>
    <p id="i-instructions" class="mt-4 text-sm text-gray-700">
      Carefully examine each featured source. Type your answers directly into the boxes. Click any <span class="tooltip-trigger">blue dotted word</span> for a definition.
    </p>
  </div>

  <main class="max-w-5xl mx-auto bg-white p-6 md:p-10 rounded-2xl shadow-xl">

    <!-- Glossary Bubble -->
    <div id="tooltip-bubble" class="hidden bg-white border-2 border-indigo-500 rounded-lg shadow-xl p-4 w-64 z-50">
      <button id="tooltip-close" class="absolute top-1 right-2 text-gray-500 hover:text-gray-900 font-bold text-lg" aria-label="Close">&times;</button>
      <h4 id="tooltip-word" class="text-lg font-bold text-indigo-700 mb-1"></h4>
      <p id="tooltip-pronunciation" class="text-sm text-gray-600 italic mb-2"></p>
      <p id="tooltip-definition" class="text-base text-gray-800"></p>
    </div>

    <!-- SOURCE A -->
    <section class="mb-16">
      <h3 class="text-2xl font-bold text-gray-800 mb-3 pb-3 border-b-2 border-indigo-200" id="i-a-title">
        Source A: Pieter Jansz Schaghen, “The Schaghen Letter,” 1626
      </h3>
      <p id="i-a-context" class="text-base text-gray-700 mb-6">
        This letter is basically the colony bragging to its bosses about buying Manhattan and shipping furs home. It lets you hear how Dutch leaders described the deal in their own words.
      </p>
      <div class="grid grid-cols-1 lg:grid-cols-2 lg:gap-8">
        <div class="mb-6 lg:mb-0">
          <h4 class="text-lg font-semibold text-gray-700 mb-3" id="i-source-material">Source Material</h4>
          <div class="highlight-toolbar mb-3" data-highlight-target="source-a-material">
            <span class="toolbar-label" data-i18n="highlightHeading">Highlights</span>
            <div class="flex flex-wrap items-center gap-2">
              <button type="button" class="highlight-btn highlight-btn-yellow" data-highlight-action="yellow">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                  <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                </svg>
                <span data-i18n="highlightYellow">Highlight Yellow</span>
              </button>
              <button type="button" class="highlight-btn highlight-btn-green" data-highlight-action="green">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                  <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                </svg>
                <span data-i18n="highlightGreen">Highlight Green</span>
              </button>
              <button type="button" class="highlight-btn highlight-btn-toggle" data-highlight-action="toggle" aria-pressed="false">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                  <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                </svg>
                <span data-i18n-toggle>Hide Highlights</span>
              </button>
              <button type="button" class="highlight-btn highlight-btn-clear" data-highlight-action="clear">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
                <span data-i18n="clearHighlights">Clear All</span>
              </button>
            </div>
          </div>
          <div id="source-a-material" class="highlight-surface prose prose-indigo bg-gray-50 p-4 rounded-lg border max-h-[600px] overflow-y-auto">
            <p id="i-a-background"></p>
            <hr>
            <p id="i-a-translation-label"></p>
            <blockquote id="i-a-translation"></blockquote>
          </div>
        </div>
        <div class="overflow-x-auto rounded-xl border border-gray-200 shadow-md overflow-hidden self-start">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gradient-to-r from-indigo-500 to-purple-600">
              <tr>
                <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider w-1/4" id="i-analysis-step">Analysis Step</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider w-3/4" id="i-your-analysis">Your Analysis</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-100">
              <tr>
                <td class="px-6 py-4 align-top font-semibold text-gray-800">
                  <span id="i-sourcing">Sourcing</span>
                  <p class="text-sm font-normal text-gray-600 mt-1" id="i-sourcing-help">(author, purpose, date/location)</p>
                </td>
                <td class="px-6 py-4 align-top"><textarea id="a-sourcing" class="w-full p-3 border-2 border-gray-200 rounded-lg" data-stem="sourcing"></textarea></td>
              </tr>
              <tr>
                <td class="px-6 py-4 align-top font-semibold text-gray-800">
                  <span id="i-cite" class="probe-target" data-probe="evidence" data-probe-context="Paraphrase the part of Schaghen's 1626 letter that proves your idea about the sale.">Cite Evidence</span>
                  <p class="text-sm font-normal text-gray-600 mt-1" id="i-cite-help">(key details paraphrased in your own words)</p>
                </td>
                <td class="px-6 py-4 align-top"><textarea id="a-cite" class="w-full p-3 border-2 border-gray-200 rounded-lg" data-stem="evidence"></textarea></td>
              </tr>
              <tr>
                <td class="px-6 py-4 align-top font-semibold text-gray-800">
                  <span id="i-bias" class="probe-target" data-probe="bias" data-probe-context="Consider Schaghen's Dutch leadership role and what he might leave out about the Munsee.">Bias / Insight</span>
                  <p class="text-sm font-normal text-gray-600 mt-1" id="i-bias-help">(perspective, what's missing?)</p>
                </td>
                <td class="px-6 py-4 align-top"><textarea id="a-bias" class="w-full p-3 border-2 border-gray-200 rounded-lg" data-stem="bias"></textarea></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- SOURCE B: Manhattan Map (no click-to-enlarge; separate link provided) -->
    <section class="mb-16">
      <h3 class="text-2xl font-bold text-gray-800 mb-3 pb-3 border-b-2 border-indigo-200" id="i-b-title">
        Source B: Map of New Amsterdam, 1660 (Castello Plan)
      </h3>
      <p id="i-b-context" class="text-base text-gray-700 mb-6">
        This hand-drawn map shows the Dutch town decades after the sale, packed with walls, canals, and ships. Looking at it helps you picture what colonists prioritized on Manhattan.
      </p>
      <div class="grid grid-cols-1 lg:grid-cols-2 lg:gap-8">
        <div class="mb-6 lg:mb-0">
          <h4 class="text-lg font-semibold text-gray-700 mb-3" id="i-source-material-2">Source Material</h4>
          <div class="highlight-toolbar mb-3" data-highlight-target="source-b-material">
            <span class="toolbar-label" data-i18n="highlightHeading">Highlights</span>
            <div class="flex flex-wrap items-center gap-2">
              <button type="button" class="highlight-btn highlight-btn-yellow" data-highlight-action="yellow">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                  <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                </svg>
                <span data-i18n="highlightYellow">Highlight Yellow</span>
              </button>
              <button type="button" class="highlight-btn highlight-btn-green" data-highlight-action="green">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                  <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                </svg>
                <span data-i18n="highlightGreen">Highlight Green</span>
              </button>
              <button type="button" class="highlight-btn highlight-btn-toggle" data-highlight-action="toggle" aria-pressed="false">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                  <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                </svg>
                <span data-i18n-toggle>Hide Highlights</span>
              </button>
              <button type="button" class="highlight-btn highlight-btn-clear" data-highlight-action="clear">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
                <span data-i18n="clearHighlights">Clear All</span>
              </button>
            </div>
          </div>
          <div id="source-b-material" class="highlight-surface prose prose-indigo bg-gray-50 p-4 rounded-lg border">
            <p><strong id="i-map-caption">1660 Map of the City of New Amsterdam (Castello Plan)</strong></p>
            <p id="i-map-tip">Click the highlighted boxes to notice key features.</p>

            <!-- Map wrapper with hotspots (no anchor) -->
            <div id="mapWrap" class="relative w-full rounded-lg overflow-hidden border border-gray-200 shadow-md">
              <img id="mapImg" src="https://upload.wikimedia.org/wikipedia/commons/0/08/Castelloplan.jpg" alt="Castello Plan of New Amsterdam, 1660" class="w-full h-auto block select-none" draggable="false"/>
              <!-- hotspots injected here -->
            </div>

            <!-- Separate link to view full size -->
            <p class="mt-3 text-sm">
              <a id="i-open-full" class="inline-flex items-center gap-1 text-indigo-700 hover:text-indigo-900 underline"
                 href="https://upload.wikimedia.org/wikipedia/commons/0/08/Castelloplan.jpg" target="_blank" rel="noopener noreferrer">
                Open full-size map in a new tab
              </a>
            </p>
          </div>
        </div>

        <div class="overflow-x-auto rounded-xl border border-gray-200 shadow-md overflow-hidden self-start">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gradient-to-r from-indigo-500 to-purple-600">
              <tr>
                <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider w-1/4" id="i-analysis-step-2">Analysis Step</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider w-3/4" id="i-your-analysis-2">Your Analysis</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-100">
              <tr>
                <td class="px-6 py-4 align-top font-semibold text-gray-800">
                  <span id="i-sourcing-2">Sourcing</span>
                  <p class="text-sm font-normal text-gray-600 mt-1" id="i-sourcing-help-2">(author, purpose, date/location)</p>
                </td>
                <td class="px-6 py-4 align-top"><textarea id="b-sourcing" class="w-full p-3 border-2 border-gray-200 rounded-lg" data-stem="sourcing"></textarea></td>
              </tr>
              <tr>
                <td class="px-6 py-4 align-top font-semibold text-gray-800">
                  <span id="i-cite-2" class="probe-target" data-probe="evidence" data-probe-context="Describe in your own words what the Castello Plan shows about Dutch control of Manhattan.">Cite Evidence</span>
                  <p class="text-sm font-normal text-gray-600 mt-1" id="i-cite-help-2">(key details or features paraphrased in your own words)</p>
                </td>
                <td class="px-6 py-4 align-top"><textarea id="b-cite" class="w-full p-3 border-2 border-gray-200 rounded-lg" data-stem="evidence"></textarea></td>
              </tr>
              <tr>
                <td class="px-6 py-4 align-top font-semibold text-gray-800">
                  <span id="i-bias-2" class="probe-target" data-probe="bias" data-probe-context="Ask what a Dutch-made map hides about Munsee people and whose priorities it highlights.">Bias / Insight</span>
                  <p class="text-sm font-normal text-gray-600 mt-1" id="i-bias-help-2">(perspective, what's missing?)</p>
                </td>
                <td class="px-6 py-4 align-top"><textarea id="b-bias" class="w-full p-3 border-2 border-gray-200 rounded-lg" data-stem="bias"></textarea></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- SOURCE C -->
    <section class="mb-16">
      <h3 class="text-2xl font-bold text-gray-800 mb-3 pb-3 border-b-2 border-indigo-200" id="i-c-title">
        Source C: “Munsee Indians,” Ohio History Central
      </h3>
      <p id="i-c-context" class="text-base text-gray-700 mb-6">
        This encyclopedia entry walks you through who the Munsee people were and what they endured after Europeans arrived. It gives you background so you can judge whether the sale truly helped them.
      </p>
      <div class="grid grid-cols-1 lg:grid-cols-2 lg:gap-8">
        <div class="mb-6 lg:mb-0">
          <h4 class="text-lg font-semibold text-gray-700 mb-3" id="i-source-material-3">Source Material</h4>
          <div class="highlight-toolbar mb-3" data-highlight-target="source-c-material">
            <span class="toolbar-label" data-i18n="highlightHeading">Highlights</span>
            <div class="flex flex-wrap items-center gap-2">
              <button type="button" class="highlight-btn highlight-btn-yellow" data-highlight-action="yellow">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                  <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                </svg>
                <span data-i18n="highlightYellow">Highlight Yellow</span>
              </button>
              <button type="button" class="highlight-btn highlight-btn-green" data-highlight-action="green">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                  <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                </svg>
                <span data-i18n="highlightGreen">Highlight Green</span>
              </button>
              <button type="button" class="highlight-btn highlight-btn-toggle" data-highlight-action="toggle" aria-pressed="false">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                  <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                </svg>
                <span data-i18n-toggle>Hide Highlights</span>
              </button>
              <button type="button" class="highlight-btn highlight-btn-clear" data-highlight-action="clear">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
                <span data-i18n="clearHighlights">Clear All</span>
              </button>
            </div>
          </div>
          <div id="source-c-material" class="highlight-surface prose prose-indigo bg-gray-50 p-4 rounded-lg border max-h-[600px] overflow-y-auto">
            <p><strong id="i-c-article-heading">SQ1: Featured Source C</strong></p>
            <p><strong id="i-c-article-title">Munsee Indians</strong></p>
            <p id="i-c-caption" class="text-sm text-indigo-700 bg-indigo-100 border-l-4 border-indigo-300 px-3 py-2 rounded-r-md">Use this background to judge how the Munsee were treated after the Manhattan sale.</p>
            <p id="i-c-para-1"></p>
            <p id="i-c-para-2"></p>
            <p id="i-c-para-3"></p>
            <p id="i-c-para-4"></p>
            <p id="i-c-source-note" class="text-sm text-gray-600"></p>
          </div>
        </div>
        <div class="overflow-x-auto rounded-xl border border-gray-200 shadow-md overflow-hidden self-start">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gradient-to-r from-indigo-500 to-purple-600">
              <tr>
                <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider w-1/4" id="i-analysis-step-3">Analysis Step</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider w-3/4" id="i-your-analysis-3">Your Analysis</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-100">
              <tr>
                <td class="px-6 py-4 align-top font-semibold text-gray-800">
                  <span id="i-sourcing-3">Sourcing</span>
                  <p class="text-sm font-normal text-gray-600 mt-1" id="i-sourcing-help-3">(author, purpose, date/location)</p>
                </td>
                <td class="px-6 py-4 align-top"><textarea id="c-sourcing" class="w-full p-3 border-2 border-gray-200 rounded-lg" data-stem="sourcing"></textarea></td>
              </tr>
              <tr>
                <td class="px-6 py-4 align-top font-semibold text-gray-800">
                  <span id="i-cite-3" class="probe-target" data-probe="evidence" data-probe-context="Summarize sentences from the encyclopedia that explain Munsee experiences after the sale.">Cite Evidence</span>
                  <p class="text-sm font-normal text-gray-600 mt-1" id="i-cite-help-3">(key details paraphrased in your own words)</p>
                </td>
                <td class="px-6 py-4 align-top"><textarea id="c-cite" class="w-full p-3 border-2 border-gray-200 rounded-lg" data-stem="evidence"></textarea></td>
              </tr>
              <tr>
                <td class="px-6 py-4 align-top font-semibold text-gray-800">
                  <span id="i-bias-3" class="probe-target" data-probe="bias" data-probe-context="Weigh how a modern encyclopedia voice might simplify or omit Munsee perspectives.">Bias / Insight</span>
                  <p class="text-sm font-normal text-gray-600 mt-1" id="i-bias-help-3">(perspective, what's missing?)</p>
                </td>
                <td class="px-6 py-4 align-top"><textarea id="c-bias" class="w-full p-3 border-2 border-gray-200 rounded-lg" data-stem="bias"></textarea></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- SOURCE D: Wisconsin First Nations (integrated embed with toggle) -->
    <section class="mb-16" id="wfn">
      <h3 class="text-2xl font-bold text-gray-800 mb-3 pb-3 border-b-2 border-indigo-200" id="i-d-title">
        Source D: “Map: Wisconsin First Nations”
      </h3>
      <p id="i-d-context" class="text-base text-gray-700 mb-6">
        This modern Wisconsin map traces where Lenape descendants, including the Munsee, are living today. It’s a reminder of how far from Manhattan many families were pushed.
      </p>
      <div class="grid grid-cols-1 lg:grid-cols-2 lg:gap-8">
        <div class="mb-6 lg:mb-0">
          <h4 class="text-lg font-semibold text-gray-700 mb-3" id="i-source-material-4">Source Material</h4>

          <div class="highlight-toolbar mb-3" data-highlight-target="source-d-material">
            <span class="toolbar-label" data-i18n="highlightHeading">Highlights</span>
            <div class="flex flex-wrap items-center gap-2">
              <button type="button" class="highlight-btn highlight-btn-yellow" data-highlight-action="yellow">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                  <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                </svg>
                <span data-i18n="highlightYellow">Highlight Yellow</span>
              </button>
              <button type="button" class="highlight-btn highlight-btn-green" data-highlight-action="green">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                  <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                </svg>
                <span data-i18n="highlightGreen">Highlight Green</span>
              </button>
              <button type="button" class="highlight-btn highlight-btn-toggle" data-highlight-action="toggle" aria-pressed="false">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                  <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                </svg>
                <span data-i18n-toggle>Hide Highlights</span>
              </button>
              <button type="button" class="highlight-btn highlight-btn-clear" data-highlight-action="clear">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
                <span data-i18n="clearHighlights">Clear All</span>
              </button>
            </div>
          </div>

          <div id="source-d-material" class="highlight-surface rounded-lg border border-gray-200 bg-white p-4">
            <!-- Integrated embed -->
            <section id="wfn-map-embed" class="max-w-[1000px] mx-auto">
            <!-- Toggle -->
            <div class="my-4 text-center">
              <button id="wfn-show" type="button" aria-pressed="false"
                      class="px-3 py-2 rounded-md border bg-white hover:bg-slate-50 text-slate-800">
                Show Counties and Cities
              </button>
              <button id="wfn-hide" type="button" aria-pressed="true"
                      class="px-3 py-2 rounded-md border bg-white hover:bg-slate-50 text-slate-800 hidden">
                Hide Counties and Cities
              </button>
            </div>

            <!-- Map + key -->
            <div class="grid grid-cols-1 gap-4">
              <div id="d-map-frame" class="relative rounded-lg overflow-hidden border border-indigo-200 shadow-md">
                <img id="wfn-map-nocounty"
                     src="https://wisconsinfirstnations.org/wp-content/themes/Revera/images/map/mapnoborder6.jpg"
                     alt="Tribal Lands map of Wisconsin without county lines"
                     class="w-full h-auto block select-none" draggable="false"/>
                <img id="wfn-map-withcounty"
                     src="https://wisconsinfirstnations.org/wp-content/themes/Revera/images/map/mapwborder6.jpg"
                     alt="Tribal Lands map of Wisconsin with county lines and cities"
                     class="w-full h-auto hidden absolute inset-0 select-none" draggable="false"/>
                <div id="d-map-wrap" class="absolute inset-0"></div>
              </div>

              <aside id="wfn-map-key" class="border p-4 rounded-md text-sm">
                <h2 id="wfn-key-title" class="text-base font-semibold m-0 mb-2">Map Key</h2>

                <div class="flex items-center gap-2 my-2">
                  <span id="wfn-key-1800">Tribal Lands circa 1800</span>
                  <img src="https://wisconsinfirstnations.org/wp-content/themes/Revera/images/map/map-key-treaty-lands.png"
                       alt="Legend swatch for Tribal Lands circa 1800"/>
                </div>

                <div class="flex items-center gap-2 my-2">
                  <span id="wfn-key-present">Present-day Native Nations</span>
                  <img src="https://wisconsinfirstnations.org/wp-content/themes/Revera/images/map/map-key-present-day-tribal-lands.png"
                       alt="Legend swatch for Present-day Native Nations"/>
                </div>

                <p id="wfn-foot" class="text-slate-600 mt-2">
                  <sup>*</sup> Brothertown is not state or federally recognized.
                </p>
              </aside>
            </div>
            <p id="i-d-tip" class="mt-3 text-sm text-gray-700">Click the glowing highlights to learn how this map supports the supporting question.</p>
            </section>

            <a id="i-open-map" href="https://wisconsinfirstnations.org/map/" target="_blank" rel="noopener noreferrer"
               class="inline-block bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-indigo-700 transition-colors no-underline">
              View Map in New Tab
            </a>
          </div>
        </div>

        <div class="overflow-x-auto rounded-xl border border-gray-200 shadow-md overflow-hidden self-start">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gradient-to-r from-indigo-500 to-purple-600">
              <tr>
                <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider w-1/4" id="i-analysis-step-4">Analysis Step</th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider w-3/4" id="i-your-analysis-4">Your Analysis</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-100">
              <tr>
                <td class="px-6 py-4 align-top font-semibold text-gray-800">
                  <span id="i-sourcing-4">Sourcing</span>
                  <p class="text-sm font-normal text-gray-600 mt-1" id="i-sourcing-help-4">(author, purpose, date/location)</p>
                </td>
                <td class="px-6 py-4 align-top"><textarea id="d-sourcing" class="w-full p-3 border-2 border-gray-200 rounded-lg" data-stem="sourcing"></textarea></td>
              </tr>
              <tr>
                <td class="px-6 py-4 align-top font-semibold text-gray-800">
                  <span id="i-cite-4" class="probe-target" data-probe="evidence" data-probe-context="Point out, in your own words, what this Wisconsin map shows about Munsee relocation.">Cite Evidence</span>
                  <p class="text-sm font-normal text-gray-600 mt-1" id="i-cite-help-4">(key details or features paraphrased in your own words)</p>
                </td>
                <td class="px-6 py-4 align-top"><textarea id="d-cite" class="w-full p-3 border-2 border-gray-200 rounded-lg" data-stem="evidence"></textarea></td>
              </tr>
              <tr>
                <td class="px-6 py-4 align-top font-semibold text-gray-800">
                  <span id="i-bias-4" class="probe-target" data-probe="bias" data-probe-context="Think about why this modern educational map was made and which Munsee stories it might not tell.">Bias / Insight</span>
                  <p class="text-sm font-normal text-gray-600 mt-1" id="i-bias-help-4">(perspective, what's missing?)</p>
                </td>
                <td class="px-6 py-4 align-top"><textarea id="d-bias" class="w-full p-3 border-2 border-gray-200 rounded-lg" data-stem="bias"></textarea></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- SUMMARY + RACE -->
    <section class="mb-12">
      <h3 class="text-2xl font-bold text-gray-800 mb-6 pb-3 border-b-2 border-indigo-200" id="i-summary-title">In Summary</h3>
      <label for="summary" class="block text-lg font-semibold text-gray-700 mb-3" id="i-summary-label">Based on all four sources, answer the supporting question in 3–5 sentences.</label>
      <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-lg shadow-md mb-4">
        <h4 class="text-xl font-bold text-gray-800 mb-3 text-center">RACE</h4>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="bg-blue-100 p-3 rounded-md border border-blue-200">
            <p class="font-bold text-blue-800">R<span class="font-normal">: <span id="i-r">Restate</span></span></p>
            <p class="text-sm text-blue-700" id="i-r-desc">Restate the question as a statement.</p>
          </div>
          <div class="bg-green-100 p-3 rounded-md border border-green-200">
            <p class="font-bold text-green-800">A<span class="font-normal">: <span id="i-a">Answer</span></span></p>
            <p class="text-sm text-green-700" id="i-a-desc">Give your claim to finish the sentence.</p>
          </div>
          <div class="bg-yellow-100 p-3 rounded-md border border-yellow-200">
            <p class="font-bold text-yellow-800">C<span class="font-normal">: <span id="i-c">Cite Evidence</span></span></p>
            <p class="text-sm text-yellow-700" id="i-c-desc">Cite specific evidence from the text.</p>
          </div>
          <div class="bg-red-100 p-3 rounded-md border border-red-200">
            <p class="font-bold text-red-800">E<span class="font-normal">: <span id="i-e">Explain</span></span></p>
            <p class="text-sm text-red-700" id="i-e-desc">Explain how the evidence supports your answer.</p>
          </div>
        </div>
      </div>
      <textarea id="summary" class="w-full h-40 p-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500" data-stem="summary"></textarea>
    </section>

    <footer class="text-center text-gray-500 text-xs mt-12 pt-6 border-t border-gray-200">
      <p>THIS WORK IS LICENSED UNDER A CREATIVE COMMONS ATTRIBUTION-NONCOMMERCIAL-SHAREALIKE 4.0 INTERNATIONAL LICENSE.</p>
      <p class="mt-1">Adapted from materials by Salt Lake City Schools and C3 Teachers.</p>
    </footer>
  </main>

  <!-- Bubbles -->
  <div id="map-bubble" class="bg-white border-2 border-indigo-500 rounded-xl shadow-2xl p-4">
    <button id="map-bubble-close" class="absolute -top-3 -end-3 bg-white border-2 border-slate-300 rounded-full w-8 h-8 text-slate-600 hover:text-slate-900" aria-label="Close">✕</button>
    <h3 id="mb-title" class="text-lg font-bold text-indigo-700 mb-1"></h3>
    <p id="mb-body" class="text-sm text-slate-800 leading-relaxed"></p>
  </div>

<script>
// ==== GOOGLE FORM BRIDGE (single-field JSON) ====
const FORM_ACTION = 'https://docs.google.com/forms/d/e/1FAIpQLSc4Sl3oBXVkZw_FD8Hp0SDmUs4himofkZwV0RBT_mbat_wi5A/formResponse';
const FORM_ENTRY  = 'entry.1120786177'; // the single short-answer "payload" item

async function postToGoogleFormPayload(payloadObject) {
  const fd = new FormData();
  fd.append(FORM_ENTRY, JSON.stringify(payloadObject));
  try {
    // Forms ignores CORS; opaque response is expected — treat as success.
    await fetch(FORM_ACTION, { method: 'POST', mode: 'no-cors', body: fd });
    return true;
  } catch (err) {
    console.warn('Form post failed:', err);
    return false;
  }
}

/* ===================== I18N ===================== */
const STR = {
  en: {
    title:"Formative Performance Task",
    sub:"Analyzing the Sale of Manhattan",
    language:"Language",
    sqTitle:"Supporting Question 1:",
    sqBody:"Did the Munsee Lenape band of Algonquin benefit from the sale of Manhattan Island?",
    instructions:"Carefully examine each featured source. Select text with your mouse, then click a highlight color to mark important ideas. Type your answers directly into the boxes. Click any blue dotted word for a definition.",
    aContext:"This letter is basically the colony bragging to its bosses about buying Manhattan and shipping furs home. It lets you hear how Dutch leaders described the deal in their own words.",
    bContext:"This hand-drawn map shows the Dutch town decades after the sale, packed with walls, canals, and ships. Looking at it helps you picture what colonists prioritized on Manhattan.",
    cContext:"This short overview explains who the Munsee are and how colonization pushed them away from Manhattan.",
    cCaption:"Use this background to judge how the Munsee were treated after the Manhattan sale.",
    dContext:"This modern Wisconsin map traces where Lenape descendants, including the Munsee, are living today. It’s a reminder of how far from Manhattan many families were pushed.",
    aBackgroundLabel:"Background:",
    aBackground:`This famous letter was sent to the governing assembly of the Dutch Republic, the <span class="tooltip-trigger" data-definition="The governing assembly (like a congress or parliament) of the Dutch Republic.">States General</span>. The Dutch West India Company ran the colony of New Netherland, and <span class="tooltip-trigger" data-pronunciation="PEE-ter YAHNS SHAH-gen" data-definition="A Dutch merchant and a director of the West India Company.">Pieter Jansz Schaghen</span> served on both the company board and the States General. He was also a merchant who traded grain, so he understood the grain samples he mentions. Schaghen wrote to share the exciting news that the colony, begun around 1624 after Henry Hudson explored the area in 1609, was growing and doing well.`,
    aTranslationLabel:"Translation:",
    aTranslation:`<p><span class="tooltip-trigger" data-definition="Formal title for the States General.">High and Mighty Lords</span>:</p>
              <p>Yesterday the ship <em>The Arms of Amsterdam</em> arrived here. It sailed away from the colony of New Netherland, near the <span class="tooltip-trigger" data-definition="Another name used by the Dutch for the Hudson River.">Mauritius River</span>, on 23 September. The report says that our people there are healthy, living peacefully, and that their families are growing.</p>
              <p>They bought Manhattan Island from the Native People for trade goods worth 60 <span class="tooltip-trigger" data-definition="Dutch currency of the time.">guilders</span>. The island measures 11,000 <span class="tooltip-trigger" data-definition="Dutch unit of land area.">morgens</span> of land.</p>
              <p>By the middle of May they had planted their fields, and by the middle of August they had harvested them. They are sending samples of the summer grains they grew: wheat, rye, barley, oats, buckwheat, canary-seed, beans, and flax.</p>
              <p>The ship is also loaded with goods to sell in Europe. The cargo includes:</p>
              <ul>
                <li>7,246 beaver <span class="tooltip-trigger" data-definition="Fur skins used for hats and coats.">pelts</span></li>
                <li>178&frac12; otter pelts</li>
                <li>675 otter pelts</li>
                <li>48 mink pelts</li>
                <li>36 <span class="tooltip-trigger" data-definition="Wild cat valued for fur.">lynx</span> pelts</li>
                <li>33 mink skins</li>
                <li>34 <span class="tooltip-trigger" data-definition="Semi-aquatic rodent valued for fur.">muskrat</span> pelts</li>
              </ul>
              <p>There is also a large amount of oak timber and nut wood.</p>
              <p>May the <span class="tooltip-trigger" data-definition="Another name for God.">Almighty</span> keep you in his care. Written in Amsterdam, 5 November 1626.</p>`,
    cArticleHeading:"SQ1: Featured Source C",
    cArticleTitle:"Munsee Indians",
    cArticleParagraphs:[
      `The <span class="tooltip-trigger" data-pronunciation="MUN-see" data-definition="A band of Lenape people whose homelands included what is now the Hudson River Valley and northern New Jersey.">Munsee</span> are a Lenape band whose territory once stretched across Manhattan, the Hudson Valley, and northern New Jersey. As <span class="tooltip-trigger" data-definition="Colonists from Europe who settled Indigenous lands in North America.">European settlers</span> arrived, Munsee families were pushed off their homelands, first toward the <span class="tooltip-trigger" data-pronunciation="suss-kweh-HAN-uh" data-definition="A major river flowing from New York through Pennsylvania into the Chesapeake Bay.">Susquehanna River</span> and later toward the <span class="tooltip-trigger" data-definition="A major river that runs from Pennsylvania to Illinois before joining the Mississippi River.">Ohio Country</span> alongside other <span class="tooltip-trigger" data-pronunciation="leh-NAH-pay" data-definition="Self-name of the Delaware people, an Algonquian-speaking Indigenous nation.">Lenape</span>.`,
      `By the early 1800s many Munsee joined “<span class="tooltip-trigger" data-definition="Munsee Lenape people who adopted Christianity through Moravian missionary work.">Christian Munsee</span>” settlements and were forced west again, this time into Wisconsin and later into <span class="tooltip-trigger" data-definition="Historical term the U.S. government used for lands in present-day Oklahoma that Native nations were forced to occupy after removal.">Indian Territory</span>. Federal laws such as the <span class="tooltip-trigger" data-definition="An 1887 U.S. law that divided communal Native lands into individual allotments and opened “surplus” land to settlers.">Dawes Act</span> broke up their remaining lands, showing how little protection the Manhattan sale gave their homes or sovereignty.`,
    ],
    cArticleSource:`Source: “Munsee Indians.” <span class="tooltip-trigger" data-definition="An online encyclopedia of Ohio history created by the Ohio History Connection.">Ohio History Central</span>, Indiana University Press, 1996, <a class="text-indigo-600 hover:text-indigo-800" href="https://ohiohistorycentral.org/w/Munsee_Indians" target="_blank" rel="noopener noreferrer">https://ohiohistorycentral.org/w/Munsee_Indians</a>. Accessed 7 Oct. 2021.`,
    highlightHeading:"Highlights",
    highlightYellow:"Highlight Yellow",
    highlightGreen:"Highlight Green",
    hideHighlights:"Hide Highlights",
    showHighlights:"Show Highlights",
    clearHighlights:"Clear All",
    sourceMaterial:"Source Material",
    analysisStep:"Analysis Step",
    yourAnalysis:"Your Analysis",
    sourcing:"Sourcing",
    sourcingHelp:"(author, purpose, date/location)",
    cite:"Cite Evidence",
    citeHelp:"(key details or features paraphrased in your own words)",
    bias:"Bias / Insight",
    biasHelp:"(perspective, what's missing?)",
    mapTitle:"Source B: Map of New Amsterdam, 1660 (Castello Plan)",
    mapCaption:"1660 Map of the City of New Amsterdam (Castello Plan)",
    mapTip:"Click the highlighted boxes to notice key features.",
    openFull:"Open full-size map in a new tab",
    dTitle:"Source D: “Map: Wisconsin First Nations”",
    dTip:"Click the glowing highlights to learn how this map supports the supporting question.",
    openMap:"View Map in New Tab",
    dSpots:{
      stockbridge:{title:"Stockbridge-Munsee Community",body:"The reservation for Munsee descendants sits in Wisconsin, far from their Manhattan homeland—evidence of forced relocation after the sale."},
      menominee:{title:"Neighboring Menominee Lands",body:"The map shows Munsee families living alongside Menominee territory, highlighting how the Munsee had to join other nations to survive away from New York."},
      distance:{title:"Distance from Manhattan",body:"Wisconsin is over 900 miles from Manhattan. Seeing the Munsee here underscores how the sale did not keep them near their original lands."}
    },
    summaryTitle:"In Summary",
    summaryLabel:"Based on all four sources, answer the supporting question in 3–5 sentences.",
    R:"Restate", A:"Answer", C:"Cite Evidence", E:"Explain",
    Rdesc:"Restate the question as a statement.",
    Adesc:"Give your claim to finish the sentence.",
    Cdesc:"Cite specific evidence from the text.",
    Edesc:"Explain how the evidence supports your answer.",
    // WFN embed strings
    wfnShow:"Show Counties and Cities",
    wfnHide:"Hide Counties and Cities",
    wfnKey:"Map Key",
    wfn1800:"Tribal Lands circa 1800",
    wfnPresent:"Present-day Native Nations",
    wfnFoot:"* Brothertown is not state or federally recognized.",
    spots:{
      fort:{title:"Fort Amsterdam",body:"Dutch military and administrative center at the tip of Manhattan. Notice the star-shaped walls and central courtyard."},
      wall:{title:"City Wall (future Wall Street)",body:"Defensive wall along the northern edge of town. This line later became Wall Street."},
      canals:{title:"Canals and Bridges",body:"Dutch-style canals cut through the settlement. Bridges connect triangular street blocks."},
      orchards:{title:"Gardens and Orchards",body:"Many plots are gardens or orchards. Food production sat right beside homes."},
      harbor:{title:"Harbor Traffic",body:"Ships crowd the harbor, showing the fur trade and Atlantic commerce that sustained the colony."}
    }
  },
  es: {
    title:"Tarea formativa",
    sub:"Análisis de la venta de Manhattan",
    language:"Idioma",
    sqTitle:"Pregunta guía 1:",
    sqBody:"¿Se benefició la banda Munsee Lenape de la venta de la isla de Manhattan?",
    instructions:"Examina atentamente cada fuente destacada. Selecciona el texto con el mouse y luego haz clic en un color para resaltar las ideas importantes. Escribe tus respuestas directamente en las casillas. Haz clic en cualquier palabra punteada en azul para ver la definición.",
    aContext:"Esta carta es la colonia presumiendo ante sus jefes de que compraron Manhattan y enviaron pieles a casa. Te permite escuchar cómo los líderes neerlandeses describieron el trato con sus propias palabras.",
    bContext:"Este mapa dibujado a mano muestra la ciudad neerlandesa décadas después de la venta, llena de murallas, canales y barcos. Al mirarlo puedes imaginar qué priorizaban los colonos en Manhattan.",
    cContext:"Esta síntesis explica quiénes son los Munsee y cómo la colonización los alejó de Manhattan.",
    cCaption:"Utiliza esta síntesis para decidir si la venta benefició realmente a los Munsee.",
    dContext:"Este mapa moderno de Wisconsin sigue dónde viven hoy los descendientes lenape, incluidos los Munsee. Recuerda lo lejos de Manhattan que fueron empujadas muchas familias.",
    aBackgroundLabel:"Contexto:",
    aBackground:`Esta famosa carta fue enviada a la asamblea gobernante de la República Neerlandesa, los <span class="tooltip-trigger" data-definition="The governing assembly (like a congress or parliament) of the Dutch Republic.">Estados Generales</span>. La Compañía Neerlandesa de las Indias Occidentales administraba la colonia de Nueva Holanda, y <span class="tooltip-trigger" data-pronunciation="PEE-ter YAHNS SHAH-gen" data-definition="A Dutch merchant and a director of the West India Company.">Pieter Jansz Schaghen</span> servía tanto en la junta de la compañía como en los Estados Generales. También era comerciante de granos, así que comprendía las muestras de grano que menciona. Schaghen escribió para compartir la emocionante noticia de que la colonia, iniciada hacia 1624 después de que Henry Hudson explorara la zona en 1609, estaba creciendo y prosperando.`,
    aTranslationLabel:"Traducción:",
    aTranslation:`<p><span class="tooltip-trigger" data-definition="Formal title for the States General.">Altos y Poderosos Señores</span>:</p>
              <p>Ayer llegó aquí el barco <em>The Arms of Amsterdam</em>. Zarpó de la colonia de Nueva Holanda, cerca del <span class="tooltip-trigger" data-definition="Another name used by the Dutch for the Hudson River.">río Mauricio</span>, el 23 de septiembre. El informe dice que nuestra gente allí está sana, vive en paz y que sus familias están creciendo.</p>
              <p>Compraron la isla de Manhattan a los Pueblos Nativos por mercancías de intercambio por valor de 60 <span class="tooltip-trigger" data-definition="Dutch currency of the time.">florines</span>. La isla mide 11&nbsp;000 <span class="tooltip-trigger" data-definition="Dutch unit of land area.">morgen</span> de tierra.</p>
              <p>A mediados de mayo ya habían sembrado sus campos y a mediados de agosto los cosecharon. Están enviando muestras de los granos de verano que cultivaron: trigo, centeno, cebada, avena, alforfón, alpiste, frijoles y lino.</p>
              <p>El barco también está cargado con bienes para vender en Europa. La carga incluye:</p>
              <ul>
                <li>7&nbsp;246 pieles de <span class="tooltip-trigger" data-definition="Fur skins used for hats and coats.">castor</span></li>
                <li>178½ pieles de nutria</li>
                <li>675 pieles de nutria</li>
                <li>48 pieles de visón</li>
                <li>36 pieles de <span class="tooltip-trigger" data-definition="Wild cat valued for fur.">lince</span></li>
                <li>33 pieles de visón</li>
                <li>34 pieles de <span class="tooltip-trigger" data-definition="Semi-aquatic rodent valued for fur.">rata almizclera</span></li>
              </ul>
              <p>También hay una gran cantidad de madera de roble y de nogal.</p>
              <p>Que el <span class="tooltip-trigger" data-definition="Another name for God.">Todopoderoso</span> los mantenga bajo su cuidado. Escrito en Ámsterdam, 5 de noviembre de 1626.</p>`,
    cArticleHeading:"PG1: Fuente destacada C",
    cArticleTitle:"Indios Munsee",
    cArticleParagraphs:[
      `Los <span class="tooltip-trigger" data-pronunciation="MUN-see" data-definition="A band of Lenape people whose homelands included what is now the Hudson River Valley and northern New Jersey.">Munsee</span> son una banda lenape cuyo territorio abarcaba Manhattan, el valle del Hudson y el norte de Nueva Jersey. Con la llegada de los <span class="tooltip-trigger" data-definition="Colonists from Europe who settled Indigenous lands in North America.">colonos europeos</span>, las familias munsee fueron expulsadas primero hacia el <span class="tooltip-trigger" data-pronunciation="suss-kweh-HAN-uh" data-definition="A major river flowing from New York through Pennsylvania into the Chesapeake Bay.">río Susquehanna</span> y más tarde hacia la región del <span class="tooltip-trigger" data-definition="A major river that runs from Pennsylvania to Illinois before joining the Mississippi River.">Ohio</span> junto con otros <span class="tooltip-trigger" data-pronunciation="leh-NAH-pay" data-definition="Self-name of the Delaware people, an Algonquian-speaking Indigenous nation.">Lenape</span>.`,
      `A principios de 1800 muchos Munsee se unieron a asentamientos de “<span class="tooltip-trigger" data-definition="Munsee Lenape people who adopted Christianity through Moravian missionary work.">Munsee cristianos</span>” y fueron obligados a desplazarse de nuevo, esta vez hacia Wisconsin y más tarde al <span class="tooltip-trigger" data-definition="Historical term the U.S. government used for lands in present-day Oklahoma that Native nations were forced to occupy after removal.">Territorio Indio</span>. Leyes federales como la <span class="tooltip-trigger" data-definition="An 1887 U.S. law that divided communal Native lands into individual allotments and opened “surplus” land to settlers.">Ley Dawes</span> fragmentaron sus tierras restantes, lo que demuestra que la venta de Manhattan no protegió sus hogares ni su soberanía.`,
    ],
    cArticleSource:`Fuente: «Munsee Indians». <span class="tooltip-trigger" data-definition="An online encyclopedia of Ohio history created by the Ohio History Connection.">Ohio History Central</span>, Indiana University Press, 1996, <a class="text-indigo-600 hover:text-indigo-800" href="https://ohiohistorycentral.org/w/Munsee_Indians" target="_blank" rel="noopener noreferrer">https://ohiohistorycentral.org/w/Munsee_Indians</a>. Consultado el 7 de octubre de 2021.`,
    highlightHeading:"Resaltados",
    highlightYellow:"Resaltar en amarillo",
    highlightGreen:"Resaltar en verde",
    hideHighlights:"Ocultar resaltados",
    showHighlights:"Mostrar resaltados",
    clearHighlights:"Borrar todo",
    sourceMaterial:"Material de la fuente",
    analysisStep:"Paso de análisis",
    yourAnalysis:"Tu análisis",
    sourcing:"Origen de la fuente",
    sourcingHelp:"(autor, propósito, fecha/lugar)",
    cite:"Citar evidencia",
    citeHelp:"(detalles o rasgos clave parafraseados con tus propias palabras)",
    bias:"Sesgo / Idea",
    biasHelp:"(perspectiva, ¿qué falta?)",
    mapTitle:"Fuente B: Mapa de Nueva Ámsterdam, 1660 (Plano de Castello)",
    mapCaption:"Mapa de 1660 de la ciudad de Nueva Ámsterdam (Plano de Castello)",
    mapTip:"Haz clic en los recuadros resaltados para notar rasgos clave.",
    openFull:"Abrir el mapa en tamaño completo en otra pestaña",
    dTitle:"Fuente D: «Mapa: Wisconsin First Nations»",
    dTip:"Haz clic en los resaltados brillantes para descubrir cómo este mapa respalda la pregunta guía.",
    openMap:"Abrir mapa en una pestaña nueva",
    dSpots:{
      stockbridge:{title:"Comunidad Stockbridge-Munsee",body:"La reserva de los descendientes munsee se ubica en Wisconsin, muy lejos de su hogar en Manhattan; evidencia el desplazamiento forzado tras la venta."},
      menominee:{title:"Tierras menominee vecinas",body:"El mapa muestra a las familias munsee conviviendo junto al territorio menominee, lo que destaca cómo tuvieron que unirse a otras naciones para sobrevivir lejos de Nueva York."},
      distance:{title:"Distancia a Manhattan",body:"Wisconsin está a más de 1,400 kilómetros de Manhattan. Ver a los munsee aquí subraya que la venta no los mantuvo cerca de sus tierras originales."}
    },
    summaryTitle:"En resumen",
    summaryLabel:"Con base en las cuatro fuentes, responde la pregunta guía en 3–5 oraciones.",
    R:"Reformular", A:"Responder", C:"Citar evidencia", E:"Explicar",
    Rdesc:"Reformula la pregunta como afirmación.",
    Adesc:"Da tu afirmación para completar la idea.",
    Cdesc:"Cita evidencia específica del texto.",
    Edesc:"Explica cómo la evidencia apoya tu respuesta.",
    wfnShow:"Mostrar condados y ciudades",
    wfnHide:"Ocultar condados y ciudades",
    wfnKey:"Leyenda del mapa",
    wfn1800:"Tierras tribales hacia 1800",
    wfnPresent:"Naciones originarias actuales",
    wfnFoot:"* Brothertown no cuenta con reconocimiento estatal ni federal.",
    spots:{
      fort:{title:"Fuerte Ámsterdam",body:"Centro militar y administrativo neerlandés en la punta de Manhattan. Observa las murallas en forma de estrella y el patio central."},
      wall:{title:"Muralla de la ciudad (futura Wall Street)",body:"Muralla defensiva en el borde norte del poblado. Luego fue Wall Street."},
      canals:{title:"Canales y puentes",body:"Canales al estilo neerlandés atraviesan el asentamiento. Puentes conectan manzanas triangulares."},
      orchards:{title:"Huertas y jardines",body:"Muchas parcelas son huertas o jardines. La producción de alimentos estaba junto a las viviendas."},
      harbor:{title:"Tráfico del puerto",body:"Los barcos llenan el puerto, señal del comercio de pieles y del Atlántico que sostenía a la colonia."}
    }
  },
  fr: {
    title:"Tâche formative",
    sub:"Analyse de la vente de Manhattan",
    language:"Langue",
    sqTitle:"Question directrice 1 :",
    sqBody:"La bande munsee lenape a-t-elle profité de la vente de Manhattan ?",
    instructions:"Examinez attentivement chaque source proposée. Sélectionnez le texte avec votre souris puis cliquez sur une couleur pour surligner les idées importantes. Saisissez vos réponses directement dans les cases. Cliquez sur un mot en pointillé bleu pour afficher la définition.",
    aContext:"Cette lettre, c’est la colonie qui se vante auprès de ses chefs d’avoir acheté Manhattan et d’envoyer des fourrures. Elle te fait entendre comment les dirigeants néerlandais racontaient l’affaire avec leurs propres mots.",
    bContext:"Ce plan dessiné à la main montre la ville néerlandaise des décennies après la vente, pleine de remparts, de canaux et de navires. En le lisant, tu imagines ce que les colons mettaient en priorité à Manhattan.",
    cContext:"Cette synthèse explique qui sont les Munsee et comment la colonisation les a éloignés de Manhattan.",
    cCaption:"Servez-vous de ce résumé pour juger si la vente a vraiment profité aux Munsee.",
    dContext:"Cette carte moderne du Wisconsin retrace où vivent aujourd’hui les descendants lenape, dont les Munsee. Elle rappelle à quel point beaucoup de familles ont été éloignées de Manhattan.",
    aBackgroundLabel:"Contexte :",
    aBackground:`Cette lettre célèbre a été envoyée à l’assemblée dirigeante de la République des Provinces-Unies, les <span class="tooltip-trigger" data-definition="The governing assembly (like a congress or parliament) of the Dutch Republic.">États généraux</span>. La Compagnie néerlandaise des Indes occidentales gérait la colonie de la Nouvelle-Néerlande, et <span class="tooltip-trigger" data-pronunciation="PEE-ter YAHNS SHAH-gen" data-definition="A Dutch merchant and a director of the West India Company.">Pieter Jansz Schaghen</span> siégeait à la fois au conseil de la compagnie et aux États généraux. Il était aussi marchand de grains, ce qui lui permettait de comprendre les échantillons qu’il mentionne. Schaghen écrivait pour annoncer que la colonie, fondée vers 1624 après l’exploration de Henry Hudson en 1609, grandissait et se portait bien.`,
    aTranslationLabel:"Traduction :",
    aTranslation:`<p><span class="tooltip-trigger" data-definition="Formal title for the States General.">Hauts et Puissants Seigneurs</span>,</p>
              <p>Hier, le navire <em>The Arms of Amsterdam</em> est arrivé ici. Il avait quitté la colonie de Nouvelle-Néerlande, près du <span class="tooltip-trigger" data-definition="Another name used by the Dutch for the Hudson River.">fleuve Maurice</span>, le 23 septembre. Le rapport indique que nos gens là-bas sont en bonne santé, vivent paisiblement et que leurs familles grandissent.</p>
              <p>Ils ont acheté l’île de Manhattan aux peuples autochtones contre des marchandises d’une valeur de 60 <span class="tooltip-trigger" data-definition="Dutch currency of the time.">florins</span>. L’île mesure 11&nbsp;000 <span class="tooltip-trigger" data-definition="Dutch unit of land area.">morgen</span> de terre.</p>
              <p>À la mi-mai, ils avaient semé leurs champs et, à la mi-août, ils les avaient récoltés. Ils envoient des échantillons des céréales d’été qu’ils ont cultivées : blé, seigle, orge, avoine, sarrasin, alpiste, haricots et lin.</p>
              <p>Le navire est aussi chargé de marchandises destinées à la vente en Europe. La cargaison comprend :</p>
              <ul>
                <li>7&nbsp;246 peaux de <span class="tooltip-trigger" data-definition="Fur skins used for hats and coats.">castor</span></li>
                <li>178½ peaux de loutre</li>
                <li>675 peaux de loutre</li>
                <li>48 peaux de vison</li>
                <li>36 peaux de <span class="tooltip-trigger" data-definition="Wild cat valued for fur.">lynx</span></li>
                <li>33 peaux de vison</li>
                <li>34 peaux de <span class="tooltip-trigger" data-definition="Semi-aquatic rodent valued for fur.">rat musqué</span></li>
              </ul>
              <p>Il y a aussi une grande quantité de bois de chêne et de noyer.</p>
              <p>Que le <span class="tooltip-trigger" data-definition="Another name for God.">Tout-Puissant</span> vous garde en sa protection. Écrit à Amsterdam, le 5 novembre 1626.</p>`,
    cArticleHeading:"QD1 : Source vedette C",
    cArticleTitle:"Les Munsee",
    cArticleParagraphs:[
      `Les <span class="tooltip-trigger" data-pronunciation="MUN-see" data-definition="A band of Lenape people whose homelands included what is now the Hudson River Valley and northern New Jersey.">Munsee</span> sont une bande lenape dont le territoire couvrait autrefois Manhattan, la vallée de l’Hudson et le nord du New Jersey. Avec l’arrivée des <span class="tooltip-trigger" data-definition="Colonists from Europe who settled Indigenous lands in North America.">colons européens</span>, les familles munsee furent repoussées hors de leurs terres, d’abord vers la <span class="tooltip-trigger" data-pronunciation="suss-kweh-HAN-uh" data-definition="A major river flowing from New York through Pennsylvania into the Chesapeake Bay.">rivière Susquehanna</span>, puis vers la <span class="tooltip-trigger" data-definition="A major river that runs from Pennsylvania to Illinois before joining the Mississippi River.">région de l’Ohio</span> aux côtés d’autres <span class="tooltip-trigger" data-pronunciation="leh-NAH-pay" data-definition="Self-name of the Delaware people, an Algonquian-speaking Indigenous nation.">Lenapes</span>.`,
      `Au début des années 1800, de nombreux Munsee rejoignirent des communautés de « <span class="tooltip-trigger" data-definition="Munsee Lenape people who adopted Christianity through Moravian missionary work.">Munsee chrétiens</span> » et furent de nouveau déplacés, cette fois vers le Wisconsin puis vers le <span class="tooltip-trigger" data-definition="Historical term the U.S. government used for lands in present-day Oklahoma that Native nations were forced to occupy after removal.">Territoire indien</span>. Des lois fédérales comme la <span class="tooltip-trigger" data-definition="An 1887 U.S. law that divided communal Native lands into individual allotments and opened “surplus” land to settlers.">loi Dawes</span> morcelèrent leurs terres restantes, montrant que la vente de Manhattan n’a pas protégé leurs foyers ni leur souveraineté.`,
    ],
    cArticleSource:`Source : « Munsee Indians ». <span class="tooltip-trigger" data-definition="An online encyclopedia of Ohio history created by the Ohio History Connection.">Ohio History Central</span>, Indiana University Press, 1996, <a class="text-indigo-600 hover:text-indigo-800" href="https://ohiohistorycentral.org/w/Munsee_Indians" target="_blank" rel="noopener noreferrer">https://ohiohistorycentral.org/w/Munsee_Indians</a>. Consulté le 7 octobre 2021.`,
    highlightHeading:"Surlignages",
    highlightYellow:"Surligner en jaune",
    highlightGreen:"Surligner en vert",
    hideHighlights:"Masquer les surlignages",
    showHighlights:"Afficher les surlignages",
    clearHighlights:"Effacer tout",
    sourceMaterial:"Texte de la source",
    analysisStep:"Étape d’analyse",
    yourAnalysis:"Votre analyse",
    sourcing:"Origine de la source",
    sourcingHelp:"(auteur, but, date/lieu)",
    cite:"Citer des preuves",
    citeHelp:"(détails ou éléments clés reformulés avec vos propres mots)",
    bias:"Biais / Analyse",
    biasHelp:"(point de vue, manques)",
    mapTitle:"Source B : plan de La Nouvelle-Amsterdam, 1660 (plan Castello)",
    mapCaption:"Plan de 1660 de La Nouvelle-Amsterdam (plan Castello)",
    mapTip:"Cliquez sur les encadrés pour observer les éléments clés.",
    openFull:"Ouvrir la carte en grand format dans un nouvel onglet",
    dTitle:"Source D : « Carte : Wisconsin First Nations »",
    dTip:"Cliquez sur les zones lumineuses pour comprendre comment cette carte soutient la question directrice.",
    openMap:"Ouvrir la carte dans un nouvel onglet",
    dSpots:{
      stockbridge:{title:"Communauté Stockbridge-Munsee",body:"La réserve des descendants munsee se situe au Wisconsin, loin de leur patrie de Manhattan — une preuve du déplacement forcé après la vente."},
      menominee:{title:"Territoires menominee voisins",body:"La carte montre des familles munsee vivant à côté des terres menominee, soulignant qu’ils ont dû se joindre à d’autres nations pour survivre loin de New York."},
      distance:{title:"Distance avec Manhattan",body:"Le Wisconsin se trouve à plus de 1 400 km de Manhattan. Voir les Munsee ici rappelle que la vente ne les a pas maintenus près de leurs terres d’origine."}
    },
    summaryTitle:"En résumé",
    summaryLabel:"À partir des quatre sources, répondez en 3–5 phrases.",
    R:"Reformuler", A:"Répondre", C:"Citer des preuves", E:"Expliquer",
    Rdesc:"Reformulez la question en affirmation.",
    Adesc:"Exposez votre thèse.",
    Cdesc:"Citez des preuves précises.",
    Edesc:"Expliquez en quoi elles soutiennent votre réponse.",
    wfnShow:"Afficher les comtés et les villes",
    wfnHide:"Masquer les comtés et les villes",
    wfnKey:"Légende",
    wfn1800:"Terres tribales vers 1800",
    wfnPresent:"Nations autochtones actuelles",
    wfnFoot:"* Brothertown n’est pas reconnue par l’État ni au niveau fédéral.",
    spots:{
      fort:{title:"Fort Amsterdam",body:"Centre militaire et administratif néerlandais à l’extrémité de Manhattan. Remarquez les remparts en étoile et la cour centrale."},
      wall:{title:"Muraille (future Wall Street)",body:"Mur défensif au nord de la ville. Cette ligne deviendra Wall Street."},
      canals:{title:"Canaux et ponts",body:"Des canaux à la néerlandaise traversent la colonie. Des ponts relient des îlots triangulaires."},
      orchards:{title:"Jardins et vergers",body:"De nombreuses parcelles sont des jardins ou vergers. La production alimentaire jouxte les habitations."},
      harbor:{title:"Trafic portuaire",body:"Des navires encombrent le port, signe du commerce des fourrures et de l’Atlantique."}
    }
  },
  ar: {
    title:"مهمة تكوينية",
    sub:"تحليل بيع مانهاتن",
    language:"اللغة",
    sqTitle:"سؤال داعم 1:",
    sqBody:"هل استفادت جماعة المونسي من شعب لنابي من بيع جزيرة مانهاتن؟",
    instructions:"افحص كل مصدر بعناية. ظلل النص بالفأرة ثم اضغط زر اللون لتظليل الأفكار المهمة. اكتب إجاباتك مباشرة في الخانات. اضغط على الكلمات ذات النقاط الزرقاء لعرض التعريف.",
    aContext:"هذه الرسالة تشبه مستعمرة تتفاخر أمام رؤسائها بأنها اشترت مانهاتن وترسل الفراء إلى الوطن. تتيح لك سماع كيف وصف القادة الهولنديون الصفقة بكلماتهم.",
    bContext:"تُظهر هذه الخريطة المرسومة يدويًا البلدة الهولندية بعد عقود من البيع، مليئة بالأسوار والقنوات والسفن. عندما تتأملها تتخيل ما كان المستوطنون يعتبرونه أولوية في مانهاتن.",
    cContext:"يلخّص هذا العرض من هم المونسي وكيف أبعدهم الاستعمار عن مانهاتن.",
    cCaption:"استخدم هذه الخلفية لتقرر ما إذا كانت الصفقة قد أفادت المونسي فعلاً.",
    dContext:"تتبع هذه الخريطة الحديثة لولاية ويسكونسن أماكن عيش أحفاد اللينابي اليوم، ومن بينهم المونسي. إنها تذكير بمدى بُعد الكثير من العائلات عن مانهاتن.",
    aBackgroundLabel:"خلفية:",
    aBackground:`أُرسلت هذه الرسالة الشهيرة إلى الهيئة الحاكمة للجمهورية الهولندية، <span class="tooltip-trigger" data-definition="The governing assembly (like a congress or parliament) of the Dutch Republic.">States General</span>. كانت شركة الهند الغربية الهولندية تدير مستعمرة نيو نذرلاند، وكان <span class="tooltip-trigger" data-pronunciation="PEE-ter YAHNS SHAH-gen" data-definition="A Dutch merchant and a director of the West India Company.">Pieter Jansz Schaghen</span> يخدم في مجلس إدارة الشركة وفي States General. وكان تاجر حبوب، لذا فهم عينات الحبوب التي يذكرها. كتب شاغين ليشارك الأخبار السارة بأن المستعمرة، التي بدأت نحو عام 1624 بعد أن استكشف هنري هدسون المنطقة عام 1609، كانت تنمو وتزدهر.`,
    aTranslationLabel:"الترجمة:",
    aTranslation:`<p><span class="tooltip-trigger" data-definition="Formal title for the States General.">أيها السادة الأجلاء الأقوياء</span>:</p>
              <p>وصلت السفينة <em>The Arms of Amsterdam</em> إلى هنا أمس. أبحرت من مستعمرة نيو نذرلاند، قرب <span class="tooltip-trigger" data-definition="Another name used by the Dutch for the Hudson River.">نهر موريشيوس</span>، في 23 أيلول/سبتمبر. يفيد التقرير بأن أهلنا هناك بصحة جيدة، يعيشون بسلام، وأن عائلاتهم تكبر.</p>
              <p>اشتروا جزيرة مانهاتن من السكان الأصليين مقابل سلع تجارية قيمتها 60 <span class="tooltip-trigger" data-definition="Dutch currency of the time.">فلورين</span>. تبلغ مساحة الجزيرة 11&nbsp;000 <span class="tooltip-trigger" data-definition="Dutch unit of land area.">مورغن</span> من الأرض.</p>
              <p>بحلول منتصف أيار/مايو كانوا قد زرعوا حقولهم، وبحلول منتصف آب/أغسطس حصدوها. يرسلون عينات من حبوب الصيف التي زرعوها: القمح والجاودار والشعير والشوفان والحِنطة السوداء وبذور الكناري والفاصوليا والكتان.</p>
              <p>السفينة محمّلة أيضًا ببضائع لبيعها في أوروبا. تتضمن الشحنة:</p>
              <ul>
                <li>7&nbsp;246 جِلد <span class="tooltip-trigger" data-definition="Fur skins used for hats and coats.">قندس</span></li>
                <li>178½ جِلد قضاعة</li>
                <li>675 جِلد قضاعة</li>
                <li>48 جِلد منك</li>
                <li>36 جِلد <span class="tooltip-trigger" data-definition="Wild cat valued for fur.">وشق</span></li>
                <li>33 جِلد منك</li>
                <li>34 جِلد <span class="tooltip-trigger" data-definition="Semi-aquatic rodent valued for fur.">جرذ المسك</span></li>
              </ul>
              <p>هناك أيضًا كمية كبيرة من خشب البلوط وخشب الجوز.</p>
              <p>ليحفظكم <span class="tooltip-trigger" data-definition="Another name for God.">القدير</span> برعايته. كُتبت في أمستردام، 5 تشرين الثاني/نوفمبر 1626.</p>`,
    cArticleHeading:"سؤال داعم 1: المصدر المميز ج",
    cArticleTitle:"شعب المونسي",
    cArticleParagraphs:[
      `يشكّل <span class="tooltip-trigger" data-pronunciation="MUN-see" data-definition="A band of Lenape people whose homelands included what is now the Hudson River Valley and northern New Jersey.">المونسي</span> فرعًا من شعب <span class="tooltip-trigger" data-pronunciation="leh-NAH-pay" data-definition="Self-name of the Delaware people, an Algonquian-speaking Indigenous nation.">اللنابي</span>، وكانت أراضيهم تمتد إلى مانهاتن ووادي هدسون وشمال نيوجيرسي. مع وصول <span class="tooltip-trigger" data-definition="Colonists from Europe who settled Indigenous lands in North America.">المستوطنين الأوروبيين</span> دُفعت عائلات المونسي بعيدًا عن موطنها، أولًا باتجاه <span class="tooltip-trigger" data-pronunciation="suss-kweh-HAN-uh" data-definition="A major river flowing from New York through Pennsylvania into the Chesapeake Bay.">نهر سسكويهانا</span> ثم نحو منطقة <span class="tooltip-trigger" data-definition="A major river that runs from Pennsylvania to Illinois before joining the Mississippi River.">الأوهايو</span> جنبًا إلى جنب مع لنابي آخرين.`,
      `في أوائل القرن التاسع عشر انضم كثير من المونسي إلى جماعات «<span class="tooltip-trigger" data-definition="Munsee Lenape people who adopted Christianity through Moravian missionary work.">المونسي المسيحيون</span>» وتعرّضوا لتهجير جديد، وهذه المرة إلى ويسكونسن ولاحقًا إلى <span class="tooltip-trigger" data-definition="Historical term the U.S. government used for lands in present-day Oklahoma that Native nations were forced to occupy after removal.">الإقليم الهندي</span>. كما جزأت قوانين اتحادية مثل <span class="tooltip-trigger" data-definition="An 1887 U.S. law that divided communal Native lands into individual allotments and opened “surplus” land to settlers.">قانون دوز</span> ما تبقى لهم من أراضٍ، ما يوضح أن بيع مانهاتن لم يحفظ مساكنهم ولا سيادتهم.`,
    ],
    cArticleSource:`المصدر: «Munsee Indians». <span class="tooltip-trigger" data-definition="An online encyclopedia of Ohio history created by the Ohio History Connection.">Ohio History Central</span>، مطبعة جامعة إنديانا، 1996، <a class="text-indigo-600 hover:text-indigo-800" href="https://ohiohistorycentral.org/w/Munsee_Indians" target="_blank" rel="noopener noreferrer">https://ohiohistorycentral.org/w/Munsee_Indians</a>. تاريخ الاطلاع: 7 تشرين الأول/أكتوبر 2021.`,
    highlightHeading:"التظليلات",
    highlightYellow:"تظليل بالأصفر",
    highlightGreen:"تظليل بالأخضر",
    hideHighlights:"إخفاء التظليلات",
    showHighlights:"إظهار التظليلات",
    clearHighlights:"مسح جميع التظليلات",
    sourceMaterial:"نص المصدر",
    analysisStep:"خطوة التحليل",
    yourAnalysis:"تحليلك",
    sourcing:"مصدر الوثيقة",
    sourcingHelp:"(المؤلف، الغرض، التاريخ/المكان)",
    cite:"الاستشهاد بالأدلة",
    citeHelp:"(تفاصيل أو سمات أساسية معاد صياغتها بكلماتك الخاصة)",
    bias:"انحياز / فكرة",
    biasHelp:"(وجهة النظر، ما الذي يغيب؟)",
    mapTitle:"المصدر ب: خريطة أمستردام الجديدة 1660 (مخطط كاستيلو)",
    mapCaption:"خريطة عام 1660 لمدينة أمستردام الجديدة (مخطط كاستيلو)",
    mapTip:"اضغط على المربعات المظللة لملاحظة السمات المهمة.",
    openFull:"افتح الخريطة بالحجم الكامل في لسان جديد",
    dTitle:"المصدر د: «خريطة: أمم ويسكونسن الأولى»",
    dTip:"انقر على المناطق المضيئة لتعرف كيف تدعم هذه الخريطة السؤال الداعم.",
    openMap:"فتح الخريطة في لسان جديد",
    dSpots:{
      stockbridge:{title:"مجتمع ستوكبريدج-مونسي",body:"تقع محمية أحفاد المونسي في ويسكونسن بعيدًا جدًا عن موطنهم في مانهاتن، وهو دليل على التهجير بعد الصفقة."},
      menominee:{title:"أراضٍ منومية مجاورة",body:"تُظهر الخريطة عائلات المونسي وهي تعيش بمحاذاة أراضي منومية، ما يبرز أنهم اضطروا للاتحاد مع أمم أخرى كي يبقوا بعيدًا عن نيويورك."},
      distance:{title:"البعد عن مانهاتن",body:"تبعد ويسكونسن أكثر من ١٤٠٠ كيلومتر عن مانهاتن، ورؤية المونسي هنا تؤكد أن البيع لم يُبقهم قريبين من أراضيهم الأصلية."}
    },
    summaryTitle:"الخلاصة",
    summaryLabel:"استنادًا إلى المصادر الأربعة، أجب في 3–5 جمل.",
    R:"إعادة الصياغة", A:"الإجابة", C:"الاستشهاد", E:"الشرح",
    Rdesc:"أعد صياغة السؤال كجملة.",
    Adesc:"قدّم ادعاءك.",
    Cdesc:"استشهد بأدلة محددة.",
    Edesc:"اشرح كيف تدعم الأدلة إجابتك.",
    wfnShow:"إظهار المقاطعات والمدن",
    wfnHide:"إخفاء المقاطعات والمدن",
    wfnKey:"مفتاح الخريطة",
    wfn1800:"أراضٍ قبلية نحو 1800",
    wfnPresent:"الأمم الأصلية الحالية",
    wfnFoot:"* جماعة بروذرتاون غير معترف بها على مستوى الولاية أو الاتحاد.",
    spots:{
      fort:{title:"حصن أمستردام",body:"المركز العسكري والإداري الهولندي عند طرف مانهاتن. لاحظ الأسوار النجمية والساحة الداخلية."},
      wall:{title:"سور المدينة (شارع وول لاحقًا)",body:"سور دفاعي على الحافة الشمالية للبلدة. أصبح لاحقًا شارع وول."},
      canals:{title:"القنوات والجسور",body:"قنوات على الطراز الهولندي تقطع المستوطنة. الجسور تصل كتل شوارع مثلثة."},
      orchards:{title:"الحدائق والبساتين",body:"عديد القطع حدائق أو بساتين. كان إنتاج الغذاء ملاصقًا للمنازل."},
      harbor:{title:"حركة الميناء",body:"السفن تملأ الميناء، علامة على تجارة الفراء والتجارة الأطلسية."}
    }
  }
};

/* ===================== Manhattan Map hotspots ===================== */
const CALLOUTS = [
  { id:"fort",     top:79.0, left:4.0,  width:14.5, height:13.0 },
  { id:"wall",     top:15.0, left:57.0, width:39.0, height:8.0  },
  { id:"canals",   top:46.0, left:34.5, width:33.0, height:15.0 },
  { id:"orchards", top:16.0, left:13.0, width:38.0, height:18.0 },
  { id:"harbor",   top:88.0, left:18.0, width:55.0, height:10.0 }
];

const D_CALLOUTS = [
  { id:"stockbridge", top:30.0, left:64.0, width:18.0, height:18.0 },
  { id:"menominee",   top:18.0, left:48.0, width:24.0, height:22.0 },
  { id:"distance",    top:62.0, left:38.0, width:30.0, height:30.0 }
];

/* ===================== Runtime wiring ===================== */
const qs = (s)=>document.querySelector(s);
const langSel = qs('#lang');
let currentLang = 'en';

function setLang(code){
  currentLang = code;
  const t = STR[code];
  document.documentElement.dir = (code==='ar')?'rtl':'ltr';
  document.documentElement.lang = code;

  qs('#i-title').textContent = t.title;
  qs('#i-sub').textContent = t.sub;
  qs('#i-language').textContent = t.language;
  qs('#i-sq-title').textContent = t.sqTitle;
  qs('#i-sq-body').textContent = t.sqBody;
  qs('#i-instructions').textContent = t.instructions;
  qs('#i-a-context').textContent = t.aContext;
  qs('#i-b-context').textContent = t.bContext;
  qs('#i-c-context').textContent = t.cContext;
  qs('#i-d-context').textContent = t.dContext;

  qs('#i-a-background').innerHTML = `<strong>${t.aBackgroundLabel}</strong> ${t.aBackground}`;
  qs('#i-a-translation-label').innerHTML = `<strong>${t.aTranslationLabel}</strong>`;
  qs('#i-a-translation').innerHTML = t.aTranslation;

  const cHeading = qs('#i-c-article-heading');
  if (cHeading) cHeading.textContent = t.cArticleHeading;
  const cTitle = qs('#i-c-article-title');
  if (cTitle) cTitle.textContent = t.cArticleTitle;
  const cCaption = qs('#i-c-caption');
  if (cCaption) cCaption.textContent = t.cCaption || '';
  const cParagraphSelectors = ['#i-c-para-1', '#i-c-para-2', '#i-c-para-3', '#i-c-para-4'];
  cParagraphSelectors.forEach((sel, idx) => {
    const el = qs(sel);
    if (!el) return;
    const copy = t.cArticleParagraphs?.[idx] || '';
    el.innerHTML = copy;
  });
  const cSource = qs('#i-c-source-note');
  if (cSource) cSource.innerHTML = t.cArticleSource;

  // A labels
  qs('#i-source-material').textContent = t.sourceMaterial;
  qs('#i-analysis-step').textContent = t.analysisStep;
  qs('#i-your-analysis').textContent = t.yourAnalysis;
  qs('#i-sourcing').textContent = t.sourcing;
  qs('#i-sourcing-help').textContent = t.sourcingHelp;
  qs('#i-cite').textContent = t.cite;
  qs('#i-cite-help').textContent = t.citeHelp;
  qs('#i-bias').textContent = t.bias;
  qs('#i-bias-help').textContent = t.biasHelp;

  // B labels
  qs('#i-b-title').textContent = t.mapTitle;
  qs('#i-source-material-2').textContent = t.sourceMaterial;
  qs('#i-analysis-step-2').textContent = t.analysisStep;
  qs('#i-your-analysis-2').textContent = t.yourAnalysis;
  qs('#i-sourcing-2').textContent = t.sourcing;
  qs('#i-sourcing-help-2').textContent = t.sourcingHelp;
  qs('#i-cite-2').textContent = t.cite;
  qs('#i-cite-help-2').textContent = t.citeHelp;
  qs('#i-bias-2').textContent = t.bias;
  qs('#i-bias-help-2').textContent = t.biasHelp;
  qs('#i-map-caption').textContent = t.mapCaption;
  qs('#i-map-tip').textContent = t.mapTip;
  qs('#i-open-full').textContent = t.openFull;

  // C labels
  qs('#i-source-material-3').textContent = t.sourceMaterial;
  qs('#i-analysis-step-3').textContent = t.analysisStep;
  qs('#i-your-analysis-3').textContent = t.yourAnalysis;
  qs('#i-sourcing-3').textContent = t.sourcing;
  qs('#i-sourcing-help-3').textContent = t.sourcingHelp;
  qs('#i-cite-3').textContent = t.cite;
  qs('#i-cite-help-3').textContent = t.citeHelp;
  qs('#i-bias-3').textContent = t.bias;
  qs('#i-bias-help-3').textContent = t.biasHelp;

  // D labels
  qs('#i-d-title').textContent = t.dTitle;
  qs('#i-source-material-4').textContent = t.sourceMaterial;
  qs('#i-analysis-step-4').textContent = t.analysisStep;
  qs('#i-your-analysis-4').textContent = t.yourAnalysis;
  qs('#i-sourcing-4').textContent = t.sourcing;
  qs('#i-sourcing-help-4').textContent = t.sourcingHelp;
  qs('#i-cite-4').textContent = t.cite;
  qs('#i-cite-help-4').textContent = t.citeHelp;
  qs('#i-bias-4').textContent = t.bias;
  qs('#i-bias-help-4').textContent = t.biasHelp;
  qs('#i-d-tip').textContent = t.dTip;
  qs('#i-open-map').textContent = t.openMap;

  // WFN embed text
  qs('#wfn-show').textContent = t.wfnShow;
  qs('#wfn-hide').textContent = t.wfnHide;
  qs('#wfn-key-title').textContent = t.wfnKey;
  qs('#wfn-key-1800').textContent = t.wfn1800;
  qs('#wfn-key-present').textContent = t.wfnPresent;
  qs('#wfn-foot').textContent = t.wfnFoot;

  // Summary
  qs('#i-summary-title').textContent = t.summaryTitle;
  qs('#i-summary-label').textContent = t.summaryLabel;
  qs('#i-r').textContent = t.R; qs('#i-a').textContent = t.A; qs('#i-c').textContent = t.C; qs('#i-e').textContent = t.E;
  qs('#i-r-desc').textContent = t.Rdesc; qs('#i-a-desc').textContent = t.Adesc; qs('#i-c-desc').textContent = t.Cdesc; qs('#i-e-desc').textContent = t.Edesc;

  wireGlossaryTriggers();
  updateHighlightTexts();

  // Close any open bubbles
  buildAllHotspots();
  closeMapBubble(); closeGlossary();
}

langSel.addEventListener('change', e=>setLang(e.target.value));

/* ===================== Manhattan Map hotspots ===================== */
const mapWrap = document.getElementById('mapWrap');
const mapImg = document.getElementById('mapImg');
const dMapWrap = document.getElementById('d-map-wrap');
const dMapImg = document.getElementById('wfn-map-nocounty');

const HOTSPOT_GROUPS = [
  { wrap: mapWrap, img: mapImg, callouts: CALLOUTS, strKey: 'spots', elements: [] },
  { wrap: dMapWrap, img: dMapImg, callouts: D_CALLOUTS, strKey: 'dSpots', elements: [] }
];

function buildAllHotspots(){
  HOTSPOT_GROUPS.forEach(group=>{
    if (!group.wrap) return;
    group.elements.forEach(el=>el.remove());
    group.elements = [];
    const dict = STR[currentLang]?.[group.strKey] || {};
    group.callouts.forEach(c=>{
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'hotspot';
      btn.style.top    = c.top+'%';
      btn.style.left   = c.left+'%';
      btn.style.width  = c.width+'%';
      btn.style.height = c.height+'%';
      btn.dataset.key = group.strKey;
      btn.dataset.id = c.id;
      const label = dict[c.id]?.title;
      if (label) btn.setAttribute('aria-label', label);
      btn.addEventListener('click', (e)=>{ e.stopPropagation(); openMapBubble(btn); });
      group.wrap.appendChild(btn);
      group.elements.push(btn);
    });
  });
}

const mapBubble = document.getElementById('map-bubble');
const mbTitle   = document.getElementById('mb-title');
const mbBody    = document.getElementById('mb-body');

function openMapBubble(btn){
  const groupKey = btn.dataset.key || 'spots';
  const dict = STR[currentLang]?.[groupKey] || {};
  const t = dict[btn.dataset.id];
  if (!t) return;
  mbTitle.textContent = t.title; mbBody.textContent = t.body;

  mapBubble.style.display='block';
  mapBubble.style.visibility='hidden';

  const rect = btn.getBoundingClientRect();
  const bRect = mapBubble.getBoundingClientRect();
  const P=10,S=10,vw=innerWidth,vh=innerHeight;

  const candidates = [
    {top:rect.top,left:rect.right+S},
    {top:rect.top,left:rect.left-bRect.width-S},
    {top:rect.bottom+S,left:rect.left},
    {top:rect.top-bRect.height-S,left:rect.left}
  ];
  let pos=candidates[0];
  for(const c of candidates){
    const fitsH = c.left>=P && (c.left+bRect.width+P)<=vw;
    const fitsV = c.top>=P && (c.top+bRect.height+P)<=vh;
    if(fitsH && fitsV){ pos=c; break; }
  }
  let top=Math.max(P,Math.min(pos.top,vh-bRect.height-P));
  let left=Math.max(P,Math.min(pos.left,vw-bRect.width-P));

  mapBubble.style.top=top+'px';
  mapBubble.style.left=left+'px';
  mapBubble.style.visibility='visible';
}
function closeMapBubble(){ mapBubble.style.display='none'; }
document.getElementById('map-bubble-close').addEventListener('click', (e)=>{ e.stopPropagation(); closeMapBubble(); });
document.addEventListener('click', (e)=>{ if(!mapBubble.contains(e.target)) closeMapBubble(); });
addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeMapBubble(); });

HOTSPOT_GROUPS.forEach(group=>{
  if (!group.img) return;
  if (group.img.complete) buildAllHotspots();
  else group.img.addEventListener('load', buildAllHotspots);
});
addEventListener('resize', ()=>{ closeMapBubble(); });

/* ===================== Glossary tooltip ===================== */
const bubble = document.getElementById('tooltip-bubble');
const bubbleWord = document.getElementById('tooltip-word');
const bubblePron = document.getElementById('tooltip-pronunciation');
const bubbleDef  = document.getElementById('tooltip-definition');
const closeBtn   = document.getElementById('tooltip-close');

function placeGlossary(target){
  bubble.classList.remove('hidden');
  const prev = bubble.style.visibility; bubble.style.visibility='hidden';

  const rect = target.getBoundingClientRect();
  const bRect = bubble.getBoundingClientRect();
  const vw=innerWidth, vh=innerHeight, P=10, S=8;

  const candidates = [
    {top:rect.top, left:rect.right+S},
    {top:rect.top, left:rect.left-bRect.width-S},
    {top:rect.bottom+S, left:rect.left},
    {top:rect.top-bRect.height-S, left:rect.left}
  ];
  let pos=candidates[0];
  for(const c of candidates){
    const fitsH = c.left>=P && (c.left+bRect.width+P)<=vw;
    const fitsV = c.top>=P && (c.top+bRect.height+P)<=vh;
    if(fitsH && fitsV){ pos=c; break; }
  }
  let top=Math.max(P,Math.min(pos.top,vh-bRect.height-P));
  let left=Math.max(P,Math.min(pos.left,vw-bRect.width-P));
  bubble.style.top=top+'px'; bubble.style.left=left+'px';
  bubble.style.visibility=prev||'visible';
}
function openGlossaryFor(el){
  const word = el.innerText;
  const definition = el.dataset.definition||'';
  const pronunciation = el.dataset.pronunciation||'';
  bubbleWord.textContent = word;
  bubbleDef.textContent = definition;
  if(pronunciation){ bubblePron.textContent=`[ ${pronunciation} ]`; bubblePron.classList.remove('hidden'); }
  else { bubblePron.textContent=''; bubblePron.classList.add('hidden'); }
  placeGlossary(el);
}
function closeGlossary(){ bubble.classList.add('hidden'); }

function wireGlossaryTriggers(){
  document.querySelectorAll('.tooltip-trigger').forEach((el)=>{
    if (el.dataset.glossaryBound === 'true') return;
    el.dataset.glossaryBound = 'true';
    el.setAttribute('tabindex','0');
    el.addEventListener('click', (e)=>{ e.stopPropagation(); openGlossaryFor(el); });
    el.addEventListener('keydown', (e)=>{
      if (e.key==='Enter' || e.key===' ') {
        e.preventDefault();
        openGlossaryFor(el);
      }
    });
  });
}

wireGlossaryTriggers();
closeBtn.addEventListener('click', (e)=>{ e.stopPropagation(); closeGlossary(); });
document.addEventListener('click', (e)=>{ if(!bubble.contains(e.target)) closeGlossary(); });
addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeGlossary(); });

/* ===================== WFN embed toggle ===================== */
(function () {
  const btnShow = document.getElementById('wfn-show');
  const btnHide = document.getElementById('wfn-hide');
  const imgNoCounty = document.getElementById('wfn-map-nocounty');
  const imgWithCounty = document.getElementById('wfn-map-withcounty');

  function showWithCounty() {
    imgNoCounty.classList.add('hidden');
    imgWithCounty.classList.remove('hidden');
    btnShow.classList.add('hidden');
    btnHide.classList.remove('hidden');
    btnShow.setAttribute('aria-pressed', 'true');
    btnHide.setAttribute('aria-pressed', 'false');
  }
  function hideWithCounty() {
    imgNoCounty.classList.remove('hidden');
    imgWithCounty.classList.add('hidden');
    btnShow.classList.remove('hidden');
    btnHide.classList.add('hidden');
    btnShow.setAttribute('aria-pressed', 'false');
    btnHide.setAttribute('aria-pressed', 'true');
  }

  btnShow.addEventListener('click', showWithCounty);
  btnHide.addEventListener('click', hideWithCounty);
})();

/* ===================== Highlight tools ===================== */
const highlightToolbars = [];

function applyHighlightToTarget(targetEl, cssClass) {
  const selection = window.getSelection();
  if (!selection?.rangeCount || selection.isCollapsed) {
    return false;
  }

  const range = selection.getRangeAt(0);
  if (!targetEl.contains(range.commonAncestorContainer)) {
    selection.removeAllRanges();
    return false;
  }

  const span = document.createElement('span');
  span.className = cssClass;
  let didApply = false;

  try {
    range.surroundContents(span);
    didApply = true;
  } catch (err) {
    console.warn('Selection could not be highlighted. Keep selections within a single paragraph.', err);
  }

  selection.removeAllRanges();
  return didApply;
}

function clearHighlightsFromTarget(targetEl) {
  const highlightedSpans = targetEl.querySelectorAll('.highlight-yellow, .highlight-green');
  if (!highlightedSpans.length) {
    window.getSelection()?.removeAllRanges();
    return false;
  }

  highlightedSpans.forEach((span) => {
    span.replaceWith(...span.childNodes);
  });

  window.getSelection()?.removeAllRanges();
  return true;
}

function updateHighlightTexts() {
  const t = STR[currentLang];
  document.querySelectorAll('[data-i18n="highlightHeading"]').forEach((el) => (el.textContent = t.highlightHeading));
  document.querySelectorAll('[data-i18n="highlightYellow"]').forEach((el) => (el.textContent = t.highlightYellow));
  document.querySelectorAll('[data-i18n="highlightGreen"]').forEach((el) => (el.textContent = t.highlightGreen));
  document.querySelectorAll('[data-i18n="clearHighlights"]').forEach((el) => (el.textContent = t.clearHighlights));

  document.querySelectorAll('[data-highlight-action="yellow"]').forEach((btn) => btn.setAttribute('aria-label', t.highlightYellow));
  document.querySelectorAll('[data-highlight-action="green"]').forEach((btn) => btn.setAttribute('aria-label', t.highlightGreen));
  document.querySelectorAll('[data-highlight-action="clear"]').forEach((btn) => btn.setAttribute('aria-label', t.clearHighlights));

  highlightToolbars.forEach((item) => item.updateToggleText?.());
}

function initHighlightTools() {
  highlightToolbars.length = 0;

  document.querySelectorAll('.highlight-toolbar').forEach((toolbar) => {
    const targetId = toolbar.dataset.highlightTarget;
    if (!targetId) return;

    const targetEl = document.getElementById(targetId);
    if (!targetEl) return;

    targetEl.classList.add('highlight-surface');

    const toggleButton = toolbar.querySelector('[data-highlight-action="toggle"]');
    const toggleLabel = toggleButton?.querySelector('[data-i18n-toggle]') || null;

    const updateToggleText = () => {
      if (!toggleButton || !toggleLabel) return;
      const hidden = targetEl.classList.contains('highlights-off');
      const t = STR[currentLang];
      toggleLabel.textContent = hidden ? t.showHighlights : t.hideHighlights;
      toggleButton.setAttribute('aria-pressed', hidden ? 'true' : 'false');
      toggleButton.setAttribute('aria-label', hidden ? t.showHighlights : t.hideHighlights);
    };

    const applyColor = (button, className) => {
      if (!button) return;
      button.addEventListener('click', () => {
        const applied = applyHighlightToTarget(targetEl, className);
        if (applied && targetEl.classList.contains('highlights-off')) {
          targetEl.classList.remove('highlights-off');
        }
        if (applied) {
          updateToggleText();
        }
      });
    };

    applyColor(toolbar.querySelector('[data-highlight-action="yellow"]'), 'highlight-yellow');
    applyColor(toolbar.querySelector('[data-highlight-action="green"]'), 'highlight-green');

    if (toggleButton) {
      toggleButton.addEventListener('click', () => {
        targetEl.classList.toggle('highlights-off');
        updateToggleText();
      });
    }

    const clearButton = toolbar.querySelector('[data-highlight-action="clear"]');
    if (clearButton) {
      clearButton.addEventListener('click', () => {
        clearHighlightsFromTarget(targetEl);
        if (targetEl.classList.contains('highlights-off')) {
          targetEl.classList.remove('highlights-off');
        }
        updateToggleText();
      });
    }

    highlightToolbars.push({ toolbar, targetEl, toggleButton, toggleLabel, updateToggleText });
    updateToggleText();
  });

  updateHighlightTexts();
}

/* ===================== Entry helpers ===================== */
function initEasternTime() {
  const stampEl = document.getElementById('eastern-timestamp');
  if (!stampEl) return;
  const formatter = new Intl.DateTimeFormat('en-US', {
    timeZone: 'America/New_York',
    dateStyle: 'medium',
    timeStyle: 'medium'
  });
  const updateTime = () => {
    stampEl.textContent = formatter.format(new Date());
  };
  updateTime();
  setInterval(updateTime, 30000);
}

function preventClipboardAction(e) {
  e.preventDefault();
}

function preventContextMenu(e) {
  e.preventDefault();
}

function preventCopyPasteShortcuts(e) {
  if ((e.ctrlKey || e.metaKey) && ['c', 'x', 'v'].includes(e.key.toLowerCase())) {
    e.preventDefault();
  }
  const key = e.key;
  if (e.shiftKey && key === 'Insert') {
    e.preventDefault();
  }
  if (e.ctrlKey && key === 'Insert') {
    e.preventDefault();
  }
  if (e.shiftKey && key === 'Delete') {
    e.preventDefault();
  }
  if (key === 'ContextMenu' || (e.shiftKey && key === 'F10')) {
    e.preventDefault();
  }
}

function initEntryFieldProtections() {
  const fields = document.querySelectorAll('textarea, [data-entry-field="true"]');
  fields.forEach((field) => {
    ['copy', 'cut', 'paste'].forEach((evt) => field.addEventListener(evt, preventClipboardAction));
    field.addEventListener('contextmenu', preventContextMenu);
    field.addEventListener('keydown', preventCopyPasteShortcuts);
  });
}

function initStudentInfoControls() {
  const infoForm = document.getElementById('student-info');
  const firstNameInput = document.getElementById('student-first-name');
  const lastNameInput = document.getElementById('student-last-name');
  const classSelect = document.getElementById('class-period');
  const submitBtn = document.getElementById('submit-work-btn');
  if (!submitBtn) return;

  if (infoForm) {
    infoForm.addEventListener('submit', (event) => event.preventDefault());
  }

  const isFilled = (input) => Boolean(input && input.value.trim());

  const updateState = () => {
    const valid = isFilled(firstNameInput) && isFilled(lastNameInput) && isFilled(classSelect);
    submitBtn.disabled = !valid;
    submitBtn.setAttribute('aria-disabled', String(!valid));
  };

  [firstNameInput, lastNameInput].forEach((input) => {
    if (input) {
      input.addEventListener('input', updateState);
    }
  });
  if (classSelect) {
    classSelect.addEventListener('change', updateState);
  }

  updateState();
}

/* ===================== Init ===================== */
document.addEventListener('DOMContentLoaded', ()=>{
  initHighlightTools();
  setLang('en');
  initStudentInfoControls();
  progressPersistenceApi = initProgressPersistence();
  initEntryFieldProtections();
  initEasternTime();
});

function getETIsoPair() {
  const now = new Date();
  const fmt = new Intl.DateTimeFormat('en-US', {
    timeZone: 'America/New_York',
    year:'numeric', month:'2-digit', day:'2-digit',
    hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:true
  });
  const parts = Object.fromEntries(fmt.formatToParts(now).map(p => [p.type, p.value]));
  const et_display = `${parts.year}-${parts.month}-${parts.day} ${parts.hour}:${parts.minute}:${parts.second} ${parts.dayPeriod} ET`;
  return { et_display, iso: now.toISOString() };
}

function readVal(id){ return (document.getElementById(id)?.value || '').trim(); }

function buildSubmissionPayload() {
  const lang = document.getElementById('lang')?.value || 'en';
  const first = readVal('student-first-name');
  const last  = readVal('student-last-name');
  const period= (document.getElementById('class-period')?.value || '').trim();

  const { et_display, iso } = getETIsoPair();

  return {
    meta: {
      assignment: "SQ1 Formative Task: Sale of Manhattan",
      page_title: document.title,
      lang,
      submitted_at_iso: iso,
      submitted_at_et: et_display,
      user_agent: navigator.userAgent
    },
    student: {
      first_name: first,
      last_name: last,
      class_period: period,
      // lightweight submission id for dedupe/debug
      submission_id: `SQ1-${Date.now().toString(36).toUpperCase()}-${Math.random().toString(36).slice(-4).toUpperCase()}`
    },
    responses: {
      A: {
        sourcing: readVal('a-sourcing'),
        cite:     readVal('a-cite'),
        bias:     readVal('a-bias')
      },
      B: {
        sourcing: readVal('b-sourcing'),
        cite:     readVal('b-cite'),
        bias:     readVal('b-bias')
      },
      C: {
        sourcing: readVal('c-sourcing'),
        cite:     readVal('c-cite'),
        bias:     readVal('c-bias')
      },
      D: {
        sourcing: readVal('d-sourcing'),
        cite:     readVal('d-cite'),
        bias:     readVal('d-bias')
      },
      summary: readVal('summary')
    }
  };
}

/* ===================== Progress persistence ===================== */
const PROGRESS_STORAGE_KEY = 'sq1-progress-draft';
const SAVEABLE_FIELD_IDS = [
  'student-first-name',
  'student-last-name',
  'class-period',
  'lang',
  'a-sourcing', 'a-cite', 'a-bias',
  'b-sourcing', 'b-cite', 'b-bias',
  'c-sourcing', 'c-cite', 'c-bias',
  'd-sourcing', 'd-cite', 'd-bias',
  'summary'
];

let progressPersistenceApi = null;

function safeReadDraft() {
  if (typeof localStorage === 'undefined') return null;
  try {
    const raw = localStorage.getItem(PROGRESS_STORAGE_KEY);
    return raw ? JSON.parse(raw) : null;
  } catch (err) {
    console.warn('Unable to read saved progress', err);
    return null;
  }
}

function safeWriteDraft(data) {
  if (typeof localStorage === 'undefined') return false;
  try {
    localStorage.setItem(PROGRESS_STORAGE_KEY, JSON.stringify(data));
    return true;
  } catch (err) {
    console.warn('Unable to save progress', err);
    return false;
  }
}

function safeClearDraft() {
  if (typeof localStorage === 'undefined') return;
  try {
    localStorage.removeItem(PROGRESS_STORAGE_KEY);
  } catch (err) {
    console.warn('Unable to clear saved progress', err);
  }
}

function collectSaveableValues() {
  const values = {};
  SAVEABLE_FIELD_IDS.forEach((id) => {
    const el = document.getElementById(id);
    if (!el || typeof el.value === 'undefined') return;
    values[id] = el.value;
  });
  return values;
}

function applySavedValues(values) {
  if (!values || typeof values !== 'object') return;
  let langToRestore = null;

  Object.entries(values).forEach(([id, value]) => {
    if (id === 'lang') {
      langToRestore = value;
      return;
    }

    const el = document.getElementById(id);
    if (!el) return;

    if (el instanceof HTMLSelectElement) {
      const hasOption = Array.from(el.options).some((opt) => opt.value === value);
      if (!hasOption) return;
      el.value = value;
      el.dispatchEvent(new Event('change', { bubbles: true }));
    } else if (typeof el.value !== 'undefined') {
      el.value = value ?? '';
      el.dispatchEvent(new Event('input', { bubbles: true }));
    }
  });

  if (typeof langToRestore === 'string' && STR[langToRestore]) {
    const langEl = document.getElementById('lang');
    if (langEl instanceof HTMLSelectElement) {
      langEl.value = langToRestore;
      setLang(langToRestore);
    }
  }
}

function formatSavedTimestamp(iso) {
  try {
    return new Intl.DateTimeFormat('en-US', {
      dateStyle: 'medium',
      timeStyle: 'short'
    }).format(new Date(iso));
  } catch (err) {
    return iso;
  }
}

function initProgressPersistence() {
  const saveBtn = document.getElementById('save-progress-btn');
  const statusEl = document.getElementById('save-progress-status');
  const labelEl = saveBtn?.querySelector('span') || null;
  const defaultLabel = labelEl?.textContent || '';

  const setStatus = (text) => {
    if (statusEl) {
      statusEl.textContent = text || '';
    }
  };

  const saved = safeReadDraft();
  if (saved?.values) {
    applySavedValues(saved.values);
    if (saved.savedAt) {
      setStatus(`Last saved: ${formatSavedTimestamp(saved.savedAt)}`);
    } else {
      setStatus('Draft restored.');
    }
  }

  if (!saveBtn) {
    return {
      clearAfterSubmit() {
        safeClearDraft();
        setStatus('');
      }
    };
  }

  const showSavedFeedback = () => {
    if (!labelEl) return;
    labelEl.textContent = 'Saved!';
    saveBtn.classList.add('ring-2', 'ring-emerald-400');
    setTimeout(() => {
      labelEl.textContent = defaultLabel;
      saveBtn.classList.remove('ring-2', 'ring-emerald-400');
    }, 1500);
  };

  saveBtn.addEventListener('click', () => {
    const values = collectSaveableValues();
    const savedAt = new Date().toISOString();
    const payload = { savedAt, values };
    const ok = safeWriteDraft(payload);
    if (ok) {
      setStatus(`Last saved: ${formatSavedTimestamp(savedAt)}`);
      showSavedFeedback();
    } else {
      alert('Could not save your progress. Please check your browser settings.');
    }
  });

  return {
    clearAfterSubmit() {
      safeClearDraft();
      if (labelEl) {
        labelEl.textContent = defaultLabel;
      }
      setStatus('Draft cleared after submission.');
    }
  };
}

/* ===================== Submit work button ===================== */
const submitWorkBtn = document.getElementById('submit-work-btn');
if (submitWorkBtn) {
  submitWorkBtn.addEventListener('click', async () => {
    if (submitWorkBtn.disabled) return;

    const firstName = document.getElementById('student-first-name');
    const lastName  = document.getElementById('student-last-name');
    const classSel  = document.getElementById('class-period');

    if (!firstName?.value.trim() || !lastName?.value.trim() || !classSel?.value.trim()) {
      alert('Please enter your first name, last name, and class period before submitting.');
      return;
    }

    // Build payload and send to Google Form single-field
    const payload = buildSubmissionPayload();

    submitWorkBtn.disabled = true;
    submitWorkBtn.setAttribute('aria-disabled','true');
    submitWorkBtn.querySelector('span').textContent = 'Submitting…';

    const ok = await postToGoogleFormPayload(payload);

    submitWorkBtn.disabled = false;
    submitWorkBtn.setAttribute('aria-disabled','false');
    submitWorkBtn.querySelector('span').textContent = 'Submit Work';

    if (ok) {
      alert('Submitted! Your work has been recorded.');
      localStorage.setItem('sq1-last-submission', JSON.stringify(payload));
      progressPersistenceApi?.clearAfterSubmit();
      // (Optional) visual confirmation or clear fields here
    } else {
      alert('Could not reach the form right now. Your work is still on this page — try again.');
    }
  });
}
</script>

<!-- ===== PROBE MODAL, STYLES, AND SCRIPT ===== -->
<style>
  /* Glow target */
  .probe-target {
    position: relative;
    cursor: pointer;
    border-radius: .4rem;
    padding: .05rem .35rem;
    box-shadow: 0 0 0 rgba(255, 215, 0, 0);
    animation: glowPulse 2s ease-in-out infinite;
  }
  .probe-target[data-probe="evidence"] { background: rgba(255, 215, 0, .12); }
  .probe-target[data-probe="bias"]     { background: rgba(93, 173, 255, .12); }

  @keyframes glowPulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(255,215,0,.0); }
    50%      { box-shadow: 0 0 16px 3px rgba(255,215,0,.45); }
  }
  .probe-target[data-probe="bias"] {
    animation-name: glowPulseBias;
  }
  @keyframes glowPulseBias {
    0%, 100% { box-shadow: 0 0 0 0 rgba(93,173,255,.0); }
    50%      { box-shadow: 0 0 16px 3px rgba(93,173,255,.45); }
  }

  /* Tiny help badge you can place next to a label */
  .help-dot {
    display: inline-flex; align-items: center; justify-content: center;
    width: 18px; height: 18px; font-size: 12px; border-radius: 50%;
    background: #111; color: #fff; margin-left: .35rem; cursor: pointer;
    border: 1px solid rgba(255,255,255,.2);
  }
  .help-dot[data-probe="evidence"] { background:#5a4; }
  .help-dot[data-probe="bias"]     { background:#36c; }

  /* Modal shell */
  .probe-modal-backdrop{
    position: fixed; inset: 0; background: rgba(0,0,0,.55);
    display: none; z-index: 1000;
  }
  .probe-modal{
    position: fixed; left: 50%; top: 50%; transform: translate(-50%,-50%);
    width: min(680px, calc(100vw - 2rem));
    background: #1f2937; color: #e5e7eb; border: 1px solid rgba(255,255,255,.08);
    border-radius: .75rem; padding: 1rem 1.25rem; z-index: 1001;
    box-shadow: 0 12px 36px rgba(0,0,0,.5);
    display: none;
  }
  .probe-header{
    display:flex; align-items:center; justify-content:space-between; gap:.5rem;
    border-bottom:1px solid rgba(255,255,255,.08); padding-bottom:.5rem; margin-bottom:.75rem;
  }
  .probe-header h3{ margin:0; font-size: 1.05rem; }
  .probe-body ul{ margin:.5rem 0 0 1.1rem; }
  .probe-body li{ margin: .35rem 0; }
  .probe-close{
    background: transparent; color: #fff; border: 1px solid rgba(255,255,255,.2);
    padding:.3rem .55rem; border-radius:.4rem; cursor:pointer;
  }
  .sr-only{ position:absolute; left:-9999px; }
</style>

<!-- Modal elements -->
<div id="probeBackdrop" class="probe-modal-backdrop" aria-hidden="true"></div>
<section id="probeModal" class="probe-modal" role="dialog" aria-modal="true" aria-labelledby="probeTitle">
  <div class="probe-header">
    <h3 id="probeTitle">Thinking Prompts</h3>
    <button class="probe-close" type="button" aria-label="Close prompts" data-probe-close>Close</button>
  </div>
  <div class="probe-body">
    <p id="probeContext" style="margin:0 0 .5rem 0; opacity:.85;"></p>
    <ul id="probeList"></ul>
  </div>
</section>

<script>
  // 1) Probing questions for each type
  const PROBES = {
    evidence: {
      title: "Cite Evidence: What should you pull from the source?",
      items: [
        "Which detail from this source can you paraphrase to support your claim?",
        "How can you restate that detail in your own words while keeping key numbers or names accurate?",
        "Where in this document, map, or image do you see proof that answers the supporting question?",
        "How does the detail you chose connect to the Munsee Lenape and the Manhattan sale?",
        "Can you paraphrase a second detail to reinforce your thinking?"
      ]
    },
    bias: {
      title: "Bias / Insight: How might point of view shape this source?",
      items: [
        "Who created this source and what was their connection to Manhattan or the Munsee?",
        "Why was it created—what message or goal did the author or mapmaker have?",
        "Which people or experiences are emphasized, and who is missing or silent?",
        "How might Munsee Lenape community members describe this moment differently?",
        "Does the time period or format (letter, map, encyclopedia, modern map) affect how much you trust it?"
      ]
    }
  };

  // 2) Modal wiring
  const modal      = document.getElementById('probeModal');
  const backdrop   = document.getElementById('probeBackdrop');
  const probeTitle = document.getElementById('probeTitle');
  const probeList  = document.getElementById('probeList');
  const probeCtx   = document.getElementById('probeContext');

  function openProbe(kind = "evidence", contextText = "") {
    const data = PROBES[kind] || PROBES.evidence;
    probeTitle.textContent = data.title;
    probeCtx.textContent = contextText;
    probeList.innerHTML = data.items.map(q => `<li>${q}</li>`).join("");
    modal.style.display = "block";
    backdrop.style.display = "block";
    backdrop.setAttribute("aria-hidden", "false");
    // Focus trap
    modal.querySelector('[data-probe-close]').focus();
  }

  function closeProbe() {
    modal.style.display = "none";
    backdrop.style.display = "none";
    backdrop.setAttribute("aria-hidden", "true");
  }

  document.addEventListener('click', (e) => {
    const t = e.target.closest('[data-probe]');
    if (t) {
      const kind = t.getAttribute('data-probe');
      const ctx  = t.getAttribute('data-probe-context') || "";
      openProbe(kind, ctx);
    }
    if (e.target.matches('[data-probe-close]') || e.target === backdrop) closeProbe();
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeProbe();
  });

  // 3) Apply sentence stems to textareas
  // Add data-stem="evidence" or data-stem="bias" to your textareas, or data-stem="sourcing" etc.
  const STEMS = {
    sourcing: "This source was created by __ in __ for __. The audience was __ which matters because __.",
    evidence: "According to Source __, it explains __ which shows __ because __.",
    bias:     "The source’s point of view affects reliability because __. It emphasizes __ but leaves out __.",
    summary:  "Overall, the Munsee Lenape __ because __. The strongest evidence is __ which shows __."
  };

  function applyStems(){
    document.querySelectorAll('textarea[data-stem]').forEach(el => {
      const k = el.getAttribute('data-stem');
      const stem = STEMS[k] || "";
      if (!el.placeholder && stem) el.placeholder = stem; // light, gray hint text
      // Optional: add a quick-insert if you want a one-click stem
      if (!el.dataset.stemButton) {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.textContent = '⚡ Insert stem';
        btn.style.cssText = 'margin:.35rem 0; padding:.2rem .45rem; font-size:.85rem; border:1px solid #ccc; border-radius:.35rem; background:#f8f8f8; cursor:pointer;';
        btn.addEventListener('click', () => {
          if (!el.value.trim()) el.value = stem;
          else el.value += (el.value.endsWith(' ') ? '' : ' ') + stem;
          el.focus();
        });
        el.insertAdjacentElement('afterend', btn);
        el.dataset.stemButton = '1';
      }
    });
  }
  // Run once on load
  document.addEventListener('DOMContentLoaded', applyStems);
</script>
</body>
</html>
